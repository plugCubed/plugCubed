/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use and/or distribute this software or parts of it for any purpose without
 fee is hereby granted, provided that the above copyright notice and this permission notice
 appear in all copies.

 Permission to copy and/or edit this software or parts of it for any purpose is NOT permitted
 without written permission by the authors.

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
var d=void 0,f=!0,h=null,l=!1;"undefined"!==typeof plugCubed&&plugCubed.close();if("undefined"===typeof p)var p={};Math.Ya=function(){return 1+Math.floor(10*Math.random())};
console.info=function(a){console.log(a);if(r!==d){a=$("#chat-messages");var b=a.scrollTop()>a[0].scrollHeight-a.height()-20;a.append('<div class="chat-update"><span class="chat-text" style="color:#FF0000">'+plugCubed.d("disconnected",[plugCubed.S()])+" "+plugCubed.d("reloading")+"</span></div>");b&&a.scrollTop(a[0].scrollHeight);setTimeout(function(){location.reload(f)},3E3)}else s||(s=f,a=$("#chat-messages"),b=a.scrollTop()>a[0].scrollHeight-a.height()-20,a.append('<div class="chat-update"><span class="chat-text" style="color:#FF0000">'+
plugCubed.d("disconnected",[plugCubed.S()])+"</span></div>"),b&&a.scrollTop(a[0].scrollHeight))};
(function(){var a=l,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function e(){!a&&this.init&&this.init.apply(this,arguments)}var g=this.prototype;a=f;var m=new this;a=l;for(var n in c)m[n]="function"==typeof c[n]&&"function"==typeof g[n]&&b.test(c[n])?function(a,b){return function(){var c=this._super;this._super=g[a];var e=b.apply(this,arguments);this._super=c;return e}}(n,c[n]):c[n];e.prototype=m;e.extend=arguments.callee;return e}})();
var r,s=l,u=Class.extend({I:{},version:{major:2,minor:0,patch:0,ya:"",toString:function(){return this.major+"."+this.minor+"."+this.patch+(this.ya!==d?"-"+this.ya:"")}},init:function(){this.proxy={menu:$.proxy(this.onMenuClick,this),W:$.proxy(this.W,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),V:$.proxy(this.V,this),Y:$.proxy(this.Y,this),Z:$.proxy(this.Z,this),U:$.proxy(this.U,this),u:$.proxy(this.u,this),B:$.proxy(this.B,this),X:$.proxy(this.X,this)};localStorage.ga!==d&&($.getScript("http://tatdk.github.io/plugCubed/compiled/langs/lang."+
localStorage.ga+".js",$.proxy(this.Ha,this)),"undefined"===typeof jQuery.fn.tabs&&($.getScript("http://code.jquery.com/ui/1.10.2/jquery-ui.js"),$("head").append('<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />')))},d:function(a,b){var c=this.lang,e;a=a.split(".");for(e in a){if(c[a[e]]===d)return"{"+a.join(".")+"}";c=c[a[e]]}if(b)for(e in b)c=c.split("%"+(~~e+1)).join(b[e]);return c},Ha:function(){this.lb={};this.wa=f;this.colors={ba:"66FFFF",M:"FF0000",
ea:"FFFF00",jb:"66FFFF"};this.pa=this.d("AFK");setTimeout(function(){plugCubed.history=[];var a=API.Na(),b;for(b in a){var g=a[b];plugCubed.history.push({id:g.media.id,author:g.media.author,title:g.media.title,ja:l,user:{id:g.user.id.toString(),username:g.user.username}})}},1);this.H=$('<style type="text/css" />');$("head").append(this.H);API.g(this.d("running",[this.version.toString()]));API.g(this.d("commandsHelp"));window.history&&history.pushState&&(function(a){if(this.history.Wa===d){var b=new CustomEvent("pushState"),
g=a.pushState;this.history.Wa=f;a.pushState=function(m){window.dispatchEvent(b);return g.apply(a,arguments)}}}(window.history),window.addEventListener("pushState",this.proxy.X));this.Ra();$("body").prepend('<link rel="stylesheet" type="text/css" id="plugcubed-css" href="http://tatdk.github.io/plugCubed/compiled/plugCubed.css" />');$("body").append('<div id="side-left" class="sidebar"><div class="sidebar-content"></div></div><div id="side-right" class="sidebar"><div class="sidebar-handle"><span>||</span></div><div class="sidebar-content"></div></div>').append('<script type="text/javascript" src="http://tatdk.github.io/plugCubed/compiled/thirdparty.js">\x3c/script>');
this.Pa();this.Oa();this.settings.userlist?(this.aa(),this.ha()):this.ta();var a=API.getUsers(),b;for(b in a)p[a[b].id]===d&&(p[a[b].id]={F:0,L:0,G:0,joinTime:this.S()});this.ka();define("plugCubed/dialog/notify",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(a,b){return a.extend({id:"dialog-notify",className:"dialog",render:function(){return this.A.append(this.getHeader(plugCubed.d("notify.header"))).append(this.da().append('<table style="width: 100%;"><tr><td>'+plugCubed.d("enable")+
'</td><td align="right"><input type="checkbox" name="enabled"'+(1===(plugCubed.settings.notify&1)?' checked="checked"':"")+' value="1" /></td></tr><tr><td>'+plugCubed.d("notify.join")+'</td><td align="right"><input type="checkbox" name="join"'+(2===(plugCubed.settings.notify&2)?' checked="checked"':"")+' value="2" /></td></tr><tr><td>'+plugCubed.d("notify.leave")+'</td><td align="right"><input type="checkbox" name="leave"'+(4===(plugCubed.settings.notify&4)?' checked="checked"':"")+' value="4" /></td></tr><tr><td>'+
plugCubed.d("notify.curate")+'</td><td align="right"><input type="checkbox" name="curate"'+(8===(plugCubed.settings.notify&8)?' checked="checked"':"")+' value="8" /></td></tr><tr><td>'+plugCubed.d("notify.stats")+'</td><td align="right"><input type="checkbox" name="songStats"'+(16===(plugCubed.settings.notify&16)?' checked="checked"':"")+' value="16" /></td></tr><tr><td>'+plugCubed.d("notify.updates")+'</td><td align="right"><input type="checkbox" name="songUpdate"'+(32===(plugCubed.settings.notify&
32)?' checked="checked"':"")+' value="32" /></td></tr></table>')).append(this.getSubmitButton(b.dialog.ok)),this._super()},submit:function(){plugCubed.settings.notify=0;this.A.find(":checked").each(function(){plugCubed.settings.notify+=~~$(this).val()});plugCubed.saveSettings();plugCubed.i("notify",1===(plugCubed.settings.notify&1));this.close()}})});define("plugCubed/dialog/customChatColors",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(a,b){return a.extend({id:"dialog-custom-colors",
className:"dialog",render:function(){var a=$('<table style="width:100%;padding:5px"/>');a.append("<tr><td>"+plugCubed.d("enable")+'</td><td align="right"><input type="checkbox" name="enabled"'+(plugCubed.settings.j.enabled?' checked="checked"':"")+" /></td></tr>");for(var c in plugCubed.Q)a.append($("<tr/>").append('<td style="color:#'+plugCubed.settings.colors[c]+'"><span>'+plugCubed.d(plugCubed.Q[c].title)+"<span></td>").append($('<td align="right"></td>').append($('<input type="text" name="'+c+
'" value="'+plugCubed.settings.colors[c]+'" placeholder="'+plugCubed.Q[c].color+'" />').data("default",plugCubed.Q[c].color).css("width","60px").change(function(){$(this).closest("tr").find("span").css("color","#"+$(this).val())}))));return this.A.append(this.getHeader(plugCubed.d("chatLimit.header"))).append(this.da().append(a)).append($("<div/>").addClass("dialog-button dialog-default-button").click(function(){$(this).parent().find('input[type="text"]').each(function(){var a=$(this);a.val(a.data("default"));
a.closest("tr").find("span").css("color","#"+a.val())})}).append($("<span/>").text("Default"))).append(this.getCancelButton()).append(this.getSubmitButton(b.dialog.ok)),this._super()},submit:function(){plugCubed.settings.customColors=this.A.find('input[name="enabled"]').is(":checked");for(var a in plugCubed.settings.colors){var b=this.A.find('input[name="'+a+'"]'),c=plugCubed.settings.colors,e=a,k;if(!(k=""===b.val()))k=b.val(),k=!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test("#"===k.substr(0,1)?k:"#"+
k);c[e]=k?b.data("default"):b.val()}plugCubed.i("colors",plugCubed.settings.customColors);plugCubed.saveSettings();this.close()}})});define("plugCubed/dialog/chatLimit",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(a,b){return a.extend({id:"dialog-chat-limit",className:"dialog",render:function(){return this.A.append(this.getHeader(plugCubed.d("chatLimit.header"))).append(this.da().append('<table style="width: 100%;"><tr><td>'+plugCubed.d("enable")+'</td><td align="right"><input type="checkbox" name="enabled"'+
(plugCubed.settings.j.enabled?' checked="checked"':"")+" /></td></tr><tr><td>"+plugCubed.d("chatLimit.limit")+'</td><td align="right"><input type="text" name="limit" value="'+plugCubed.settings.j.limit+" /></td></tr></table>")).append(this.getSubmitButton(b.dialog.ok)),this._super()},submit:function(){plugCubed.settings.j.enabled=this.A.find('input[name="enabled"]').is(":checked");plugCubed.settings.j.limit=~~this.A.find('input[name="chat-limit"]').val();plugCubed.i("chatlimit",plugCubed.settings.j.enabled);
plugCubed.saveSettings();if(plugCubed.settings.j.enabled){var a=$("#chat-messages").children("div"),b=a.length,c=0;a.each(function(){++c<b-plugCubed.settings.j.limit&&$(this).remove()})}this.close()}})});define("plugCubed/dialog/commands",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(a,b){return a.extend({id:"dialog-commands",className:"dialog",render:function(){var a="<table>",c;for(c in plugCubed.ba)a+="<tr><td>"+plugCubed.ba[c][0]+"</td><td>"+plugCubed.ba[c][1]+"</td></tr>";a+=
"</table>";if(API.hasPermission(d,API.f.BOUNCER)){a='<div id="plugCubedCommands"><ul><li><a href="#user">'+plugCubed.d("commands.userCommands")+'</a></li><li><a href="#mod">'+plugCubed.d("commands.modCommands")+'</a></li></ul><div id="user">'+a+'</div><div id="mod"><table>';for(c in plugCubed.M)API.hasPermission(d,plugCubed.M[c][2])&&(a+="<tr><td>"+plugCubed.M[c][0]+"</td><td>"+plugCubed.M[c][1]+"</td></tr>");a=$(a+"</table></div></div>").tabs()}return this.A.append(this.getHeader(plugCubed.d("commands.header"))).append(this.da().append(a)).append(this.getSubmitButton(b.dialog.ok)),
this._super()},submit:function(){this.close()}})})},X:function(){"undefined"!==typeof plugCubed&&setTimeout(function(){API.enabled?(plugCubed.close(),plugCubed=new u):plugCubed.X()},500)},close:function(){API.off(API.Fa,this.oa);API.off(API.DJ_ADVANCE,this.proxy.W);API.off(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.off(API.CURATE_UPDATE,this.proxy.V);API.off(API.USER_JOIN,this.proxy.Y);API.off(API.USER_LEAVE,this.proxy.Z);API.off(API.CHAT,this.proxy.U);API.off(API.VOTE_SKIP,this.proxy.B);API.off(API.USER_SKIP,
this.proxy.B);API.off(API.MOD_SKIP,this.proxy.B);API.off(API.WAIT_LIST_UPDATE,this.proxy.u);window.removeEventListener("pushState",this.proxy.onRoomJoined);for(var a in plugCubed.I)a===d||plugCubed.I[a]===d||($("#plugcubed-btn-"+a).unbind(),delete plugCubed.I[a]);$("#plugcubed-css").remove();$("#plugcubed-js-extra").remove();$("#side-right").remove();$("#side-left").remove();$("#notify-dialog").remove();this.H&&this.H.remove();this.k&&(this.k.onclose=function(){},this.k.close());requirejs.ia("plugCubed/dialog/notify");
requirejs.ia("plugCubed/dialog/customChatColors");requirejs.ia("plugCubed/dialog/chatLimit");requirejs.ia("plugCubed/dialog/commands");delete plugCubed},ka:function(){this.k=new SockJS("http://socket.plugpony.net:923/gateway");this.k.O=0;this.k.onopen=function(){this.O=0;var a=API.getUser();this.send(JSON.stringify({type:"userdata",id:a.id,username:a.username,room:window.location.pathname.split("/")[1],version:plugCubed.version.toString()}))};this.k.onmessage=function(a){a=JSON.parse(a.data);"update"===
a.type?(plugCubed.k.onclose=function(){},plugCubed.k.close(),API.g(plugCubed.d("newVersion"),h,plugCubed.colors.ea),setTimeout(function(){$.getScript("http://tatdk.github.io/plugCubed/compiled/plugCubed."+(plugCubed.wa?"min.":"")+"js")},5E3)):"chat"===a.type&&require("app/facades/ChatFacade").receive(a.data)};this.k.onclose=function(){this.O++;var a;if(5>this.O)a=5;else if(30>this.O)a=30;else if(60>this.O)a=60;else return;setTimeout(function(){plugCubed.ka()},1E3*a)}},ha:function(){$("#side-left").show().animate({left:"0px"},
300,"undefined"===typeof jQuery.easing.La?d:"easeOutQuart")},ta:function(){var a=-$("#side-left").width()-20;$("#side-left").animate({left:a+"px"},300,"undefined"===typeof jQuery.easing.La?d:"easeOutQuart",function(){$("#side-left").hide()})},Q:{you:{title:"ranks.you",color:"FFDD6F"},regular:{title:"ranks.regular",color:"B0B0B0"},featureddj:{title:"ranks.featureddj",color:"E90E82"},bouncer:{title:"ranks.bouncer",color:"E90E82"},manager:{title:"ranks.manager",color:"E90E82"},cohost:{title:"ranks.cohost",
color:"E90E82"},host:{title:"ranks.host",color:"E90E82"},ambassador:{title:"ranks.ambassador",color:"9A50FF"},admin:{title:"ranks.admin",color:"42A5DC"},join:{title:"notify.join",color:"3366FF"},leave:{title:"notify.leave",color:"3366FF"},curate:{title:"notify.curate",color:"00FF00"},za:{title:"notify.stats",color:"66FFFF"},Aa:{title:"notify.updates",color:"FFFF00"}},settings:{recent:l,awaymsg:"",autowoot:l,autojoin:l,userlist:l,autorespond:l,menu:l,notify:0,customColors:l,R:f,eb:f,z:[],J:[],la:[],
C:l,j:{enabled:l,limit:50},colors:{you:"FFDD6F",regular:"B0B0B0",featureddj:"E90E82",bouncer:"E90E82",manager:"E90E82",cohost:"E90E82",host:"E90E82",ambassador:"9A50FF",admin:"42A5DC",join:"3366FF",leave:"3366FF",curate:"00FF00",za:"66FFFF",Aa:"FFFF00"}},Ra:function(){if(localStorage.xa!==d){var a=JSON.parse(localStorage.xa),b;for(b in this.settings)a[b]!==d&&(this.settings[b]=a[b]);this.settings.recent=l;this.settings.autowoot&&this.Ba();this.settings.userlist&&(this.aa(),this.ha());this.settings.customColors&&
this.Za();0<this.settings.z.length&&-1<this.settings.z.indexOf(Models.room.data.media.id)&&(API.setVolume(0),this.settings.C=f,API.g(this.d("automuted",[Models.room.data.media.title])));JSON.parse(require("app/store/LocalStorage").getItem("prefs")).R===d&&(a=JSON.parse(require("app/store/LocalStorage").getItem("prefs")),a.R=f,require("app/store/LocalStorage").setItem("prefs",JSON.stringify(a)))}},saveSettings:function(){localStorage.xa=JSON.stringify(this.settings)},Za:function(){this.settings.customColors?
this.H.text([".chat-message .chat-from,",".chat-mention .chat-from { color:#"+this.settings.colors.regular+"!important; }",".chat-message .chat-from-featureddj,",".chat-mention .chat-from-featureddj { color:#"+this.settings.colors.featureddj+"!important; }",".chat-message .chat-from-bouncer,",".chat-mention .chat-from-bouncer { color:#"+this.settings.colors.bouncer+"!important; }",".chat-message .chat-from-manager,",".chat-mention .chat-from-manager { color:#"+this.settings.colors.manager+"!important; }",
".chat-message .chat-from-cohost,",".chat-mention .chat-from-cohost { color:#"+this.settings.colors.cohost+"!important; }",".chat-message .chat-from-host,",".chat-mention .chat-from-host { color:#"+this.settings.colors.host+"!important; }",".chat-message .chat-from-ambassador,",".chat-mention .chat-from-ambassador { color:#"+this.settings.colors.ambassador+"!important; }",".chat-message .chat-from-admin,",".chat-mention .chat-from-admin { color:#"+this.settings.colors.admin+"!important; }",".chat-message .chat-from-you,",
".chat-mention .chat-from-you { color:#"+this.settings.colors.you+"!important; }"].join("\n")):this.H.text("")},Oa:function(){API.on(API.Fa,this.oa);API.on(API.DJ_ADVANCE,this.proxy.W);API.on(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.on(API.CURATE_UPDATE,this.proxy.V);API.on(API.USER_JOIN,this.proxy.Y);API.on(API.USER_LEAVE,this.proxy.Z);API.on(API.CHAT,this.proxy.U);API.on(API.VOTE_SKIP,this.proxy.B);API.on(API.USER_SKIP,this.proxy.B);API.on(API.MOD_SKIP,this.proxy.B);API.on(API.WAIT_LIST_UPDATE,
this.proxy.u)},Pa:function(){$("#side-right .sidebar-content").html("");this.q(this.settings.autowoot,"woot",this.d("menu.autowoot"));this.q(this.settings.autojoin,"join",this.d("menu.autojoin"));this.q(this.settings.userlist,"userlist",this.d("menu.userlist"));this.q(this.settings.customColors,"colors",this.d("menu.customchatcolors"));this.q(this.settings.autorespond,"autorespond",this.d("menu.afkstatus"));this.q(1===(this.settings.notify&1),"notify",this.d("menu.notify"));this.q(this.settings.j.enabled,
"chatlimit",this.d("menu.limitchatlog"));this.q(!JSON.parse(require("app/store/LocalStorage").getItem("prefs")).streamDisabled,"stream",this.d("menu.stream"));this.q(JSON.parse(require("app/store/LocalStorage").getItem("prefs")).R,"emoji",this.d("menu.emoji"))},q:function(a,b,c){this.I[b]===d&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+b+'"><div class="status-'+(a?"on":
"off")+'"></div>'+c+"</a>"),$("#plugcubed-btn-"+b).data("key",b).click(this.proxy.menu),this.I[b]={text:c})},i:function(a,b){$("#plugcubed-btn-"+a).find('[class^="status-"], [class*=" status-"]').attr("class","status-"+(b===f?"on":"off"))},aa:function(){0<$("#side-left .sidebar-content").children().length&&$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").bind("contextmenu",function(){return l});$("#side-left .sidebar-content").html('<h1 class="users">Users: '+API.getUsers().length+
"</h1>");var a=API.getWaitListPosition(),a=$("<h3></h3>").addClass("waitlistspot").text("Waitlist: "+(-1!=a?a+" / ":"")+API.getWaitList().length);$("#side-left .sidebar-content").append(a).append("<hr />");var a=API.getUsers(),b;for(b in a)this.Ia(a[b])},Ia:function(a){var b,c=require("app/utils/Utilities").cleanTypedString(a.username);b=a.curated==f?"curate":this.D(a.id)?"plugcubed":this.va(a.id)?"vip":API.hasPermission(a.id,API.f.Ca)?"admin":API.hasPermission(a.id,API.f.Ea)?"ambassador":API.hasPermission(a.id,
API.f.Ga)?"host":API.hasPermission(a.id,API.f.COHOST)?"host":API.hasPermission(a.id,API.f.MANAGER)?"manager":API.hasPermission(a.id,API.f.BOUNCER)?"bouncer":API.hasPermission(a.id,API.f.FEATUREDDJ)?"fdj":"normal";0<API.getDJs().length&&API.getDJs()[0].id==a.id?this.ma("normal"===b?"void":b+"_current","#66FFFF",a.username):this.ma("normal"===b?"void":b+this.Xa(a.vote),this.Ja(a.vote),c)},Ja:function(a){var b="";if(a===d)b="FFFFFF";else switch(a){case -1:b="ED1C24";break;case 1:b="3FFF00";break;default:b=
"FFFFFF"}return"#"+b},Xa:function(a){var b="";if(a===d)b="undecided";else switch(a){case -1:b="meh";break;case 1:b="woot";break;default:b="undecided"}return"_"+b},ma:function(a,b,c){$("#side-left .sidebar-content").append($("<p></p>").append($("<span></span>").append($("<span></span>").addClass(a)).css("cursor","pointer").css("color",b).mousedown(function(a){switch(a.which){case 1:$("#chat-input-field").val($("#chat-input-field").val()+"@"+c+" ").focus();break;case 3:(API.hasPermission(d,API.f.BOUNCER)||
plugCubed.D(API.getUser().id))&&plugCubed.T(c)}}).html(function(a,b){return b+c})))},getUser:function(a){a=a.trim();"@"===a.substr(0,1)&&(a=a.substr(1));var b=API.getUsers(),c;for(c in b)if(("string"!==typeof a?0:b[c].username.toLowerCase()===a.toLowerCase())||("string"!==typeof a?0:b[c].id.toLowerCase()===a.toLowerCase()))return b[c];return h},fa:function(a,b){if(API.hasPermission(d,API.f.BOUNCER)){var c;switch(b){case "kick":c=API.moderateKickUser;break;case "removedj":c=API.moderateRemoveDJ;break;
case "adddj":c=API.moderateAddDJ;break;default:API.g(this.d("error.unknownModeration"));return}var e=this.getUser(a);e===h?API.g(this.d("error.userNotFound")):c(e.id," ")}},T:function(a){a=this.getUser(a);if(a===h)API.g(this.d("error.userNotFound"));else{var b=p[a.id],c,e,g,m,n=a.djPoints+a.curatorPoints+a.listenerPoints,t=b.F+b.L;g=API.getWaitListPosition();var k=-1;e=API.getDJs();c=API.hasPermission(a.id,API.f.Ca)?this.d("ranks.admin"):API.hasPermission(a.id,API.f.Ea)?this.d("ranks.ambassador"):
API.hasPermission(a.id,API.f.Ga)?this.d("ranks.host"):API.hasPermission(a.id,API.f.COHOST)?this.d("ranks.cohost"):API.hasPermission(a.id,API.f.MANAGER)?this.d("ranks.manager"):API.hasPermission(a.id,API.f.BOUNCER)?this.d("ranks.bouncer"):API.hasPermission(a.id,API.f.FEATUREDDJ)?this.d("ranks.featureddj"):this.d("ranks.regular");if(-1===g)if(0<e.length&&e[0].id===a.id)m=this.d("info.djing"),k=0;else{for(g=1;g<e.length;g++)k=e.id===a.id?g:k;m=0>k?this.d("info.notinlist"):this.d("info.inbooth",[k+1,
e.length])}else m=this.d("info.inwaitlist",[g,API.getWaitList().length]);switch(a.status){default:e=this.d("status.available");break;case API.P.Da:e=this.d("status.afk");break;case API.P.cb:e=this.d("status.working");break;case API.P.bb:e=this.d("status.sleeping")}switch(a.vote){case -1:g=this.d("vote.meh");break;default:g=this.d("vote.undecided");break;case 1:g=this.d("vote.woot")}0===k&&(g=this.d("vote.djing"));k=d;this.D(a.id)&&(k=this.d("info.specialTitles.developer"));this.va(a.id)&&(k=this.d("info.specialTitles.vip"));
var q=$("#chat-messages"),v=q.scrollTop()>q[0].scrollHeight-q.height()-20;q.append('<div class="chat-update"><table style="width:100%;color:#CC00CC"><tr><td colspan="2"><strong>'+this.d("info.name")+'</strong>: <span style="color:#FFFFFF">'+a.username+"</span></td></tr>"+(k?'<tr><td colspan="2"><strong>'+this.d("info.title")+'</strong>: <span style="color:#FFFFFF">'+k+"</span></td></tr>":"")+'<tr><td colspan="2"><strong>'+this.d("info.id")+'</strong>: <span style="color:#FFFFFF">'+a.id+"</span></td></tr><tr><td><strong> "+
this.d("info.rank")+'</strong>: <span style="color:#FFFFFF">'+c+"</span></td><td><strong>"+this.d("info.joined")+'</strong>: <span style="color:#FFFFFF">'+b.joinTime+"</span></td></tr><tr><td><strong>"+this.d("info.status")+'</strong>: <span style="color:#FFFFFF">'+e+"</span></td><td><strong> "+this.d("info.vote")+'</strong>: <span style="color:#FFFFFF">'+g+'</span></td></tr><tr><td colspan="2"><strong>'+this.d("info.position")+'</strong>: <span style="color:#FFFFFF">'+m+"</span></td></tr><tr><td><strong>"+
this.d("info.points")+'</strong>: <span style="color:#FFFFFF" title = "'+this.d("info.pointType.dj",[a.djPoints])+"  +  "+this.d("info.pointType.listener",[a.listenerPoints])+"  +  "+this.d("info.pointType.curator",[a.curatorPoints])+'">'+n+"</span></td><td><strong> "+this.d("info.fans")+'</strong>: <span style="color:#FFFFFF">'+a.fans+"</span></td></tr><tr><td><strong>"+this.d("info.wootCount")+'</strong>: <span style="color:#FFFFFF">'+b.F+"</span></td><td><strong>"+this.d("info.mehCount")+'</strong>: <span style="color:#FFFFFF">'+
b.L+'</span></td></tr><tr><td colspan="2"><strong>'+this.d("info.ratio")+'</strong>: <span style="color:#FFFFFF">'+(0===t?"0":(b.F/t).toFixed(2))+"</span></td></tr></table></div>");v&&q.scrollTop(q[0].scrollHeight)}},onMenuClick:function(a){a=$(a.currentTarget).data("key");switch(a){case "woot":this.settings.autowoot=!this.settings.autowoot;this.i("woot",this.settings.autowoot);this.settings.autowoot&&$("#button-vote-positive").click();break;case "join":this.settings.autojoin=!this.settings.autojoin;
this.i("join",this.settings.autojoin);this.settings.autojoin&&0<$("#button-dj-waitlist-join").length&&API.qa();break;case "userlist":this.settings.userlist=!this.settings.userlist;this.i("userlist",this.settings.userlist);this.settings.userlist?(this.aa(),this.ha()):($("#side-left .sidebar-content").empty(),this.ta());break;case "colors":require(["plugCubed/dialog/customChatColors","app/base/Context","app/events/ShowDialogEvent"],function(a,c,e){c.dispatch(new e(e.ca,new a))});break;case "autorespond":this.settings.autorespond=
!this.settings.autorespond;this.i("autorespond",this.settings.autorespond);if(this.settings.autorespond){a=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.awaymsg?this.pa:this.settings.awaymsg);if(a===h){this.settings.autorespond=l;this.i("autorespond",l);return}a=a.split("@").join("").trim();this.settings.awaymsg=""===a?this.pa:a;0>=API.getUser().status&&API.N(API.P.Da)}else API.N(API.P.$a);break;case "notify":require(["plugCubed/dialog/notify",
"app/base/Context","app/events/ShowDialogEvent"],function(a,c,e){c.dispatch(new e(e.ca,new a))});break;case "chatlimit":require(["plugCubed/dialog/chatLimit","app/base/Context","app/events/ShowDialogEvent"],function(a,c,e){c.dispatch(new e(e.ca,new a))});break;case "stream":return a=JSON.parse(require("app/store/LocalStorage").getItem("prefs")).streamDisabled,this.i("stream",a),API.sendChat(a?"/stream on":"/stream off");case "emoji":return a=JSON.parse(require("app/store/LocalStorage").getItem("prefs")).R===
l,this.i("emoji",a),API.sendChat(a?"/emoji on":"/emoji off");default:return API.g(this.d("menu.unknown"))}this.saveSettings()},kb:function(){for(var a in this.settings.colors){var b=$('input[name="'+a+'"]');b.val(b.data("ph"));b.parents(".dialog-input-container").find(".dialog-input-label").css("color","#"+b.val())}},onVoteUpdate:function(a){if(a&&a.user){var b=p[a.user.id];this.u();1===b.G?b.F--:-1===b.G&&b.L--;1===a.vote?b.F++:-1===a.vote&&b.L++;b.G=a.vote}},V:function(a){var b=API.getMedia();if(9===
(this.settings.notify&9)){var c=$("#chat-messages"),e=c.scrollTop()>c[0].scrollHeight-c.height()-20;c.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.colors.curate+'">'+this.d("notify.message.curate",[a.user.username,b.author,b.title])+"</span></div>");e&&c.scrollTop(c[0].scrollHeight)}API.getUser(a.user.id).curated=f;this.u()},W:function(a){if(17===(this.settings.notify&17)){var b=$("#chat-messages"),c=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+
this.settings.colors.za+'">'+this.d("notify.message.stats",[a.lastPlay.score.positive,a.lastPlay.score.negative,a.lastPlay.score.curates])+"</span></div>");c&&b.scrollTop(b[0].scrollHeight)}33===(this.settings.notify&33)&&(b=$("#chat-messages"),c=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.colors.Aa+'">'+this.d("notify.message.updates",[a.media.title,a.media.author,a.dj.username])+"</span></div>"),c&&b.scrollTop(b[0].scrollHeight));
setTimeout($.proxy(this.Ta,this),1E3*Math.Ya());(API.hasPermission(d,API.f.BOUNCER)||this.D(API.getUser().id))&&this.Ua(a.media.id);this.history.unshift({id:a.media.id,author:a.media.author,title:a.media.title,ja:l,user:{id:a.dj.id,username:a.dj.username}});this.history.splice(50,this.history.length-50);this.settings.C&&0>this.settings.z.indexOf(a.media.id)&&(setTimeout(function(){API.setVolume(plugCubed.lastVolume)},800),this.settings.C=l);!this.settings.C&&-1<this.settings.z.indexOf(a.media.id)&&
(setTimeout(function(){API.setVolume(0)},800),this.settings.C=f,this.lastVolume=API.ra(),API.g(i18n("automuted",[a.media.title])));this.u();a=API.getUsers();for(var e in a)p[a[e].id].G=0},Ta:function(){this.settings.autowoot&&0>this.settings.z.indexOf(API.Na()[0].media.id)&&this.Ba();this.settings.autojoin&&("block"===$("#button-dj-play").css("display")||"block"===$("#button-dj-waitlist-join").css("display"))&&API.qa()},Ba:function(){if(0!==API.getDJs().length){var a=API.getDJs()[0];a===h||a==API.getUser()||
$("#button-vote-positive").click()}},Y:function(a){if(3===(this.settings.notify&3)){var b=$("#chat-messages"),c=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.colors.join+'">'+require("app/utils/Utilities").cleanTypedString(a.username+" joined the room")+"</span></div>");c&&b.scrollTop(b[0].scrollHeight)}p[a.id]===d&&(p[a.id]={F:0,L:0,G:0,joinTime:this.S()});this.u()},Z:function(a){if(5===(this.settings.notify&
5)){var b=$("#chat-messages"),c=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.colors.leave+'">'+require("app/utils/Utilities").cleanTypedString(a.username+" left the room")+"</span></div>");c&&b.scrollTop(b[0].scrollHeight)}this.u()},D:function(a){return"50aeb31696fba52c3ca0adb6"==a||"50aeb077877b9217e2fbff00"==a},va:function(a){return"5112c273d6e4a94ec0554792"==a||"50b1961c96fba57db2230417"==a},na:function(a){var b=
"mention"==a.type&&API.hasPermission(a.fromID,API.f.BOUNCER),c=0>a.message.indexOf("@")&&this.D(a.fromID);if(b||c)-1<a.message.indexOf("!disable")&&(this.settings.autojoin?(this.settings.autojoin=l,this.i("join",this.settings.autojoin),this.saveSettings(),API.Ka(),API.sendChat("@"+a.from+" Autojoin disabled")):API.sendChat("@"+a.from+" Autojoin was not enabled")),-1<a.message.indexOf("!afkdisable")&&(this.settings.autorespond?(this.settings.autorespond=l,this.i("autorespond",this.settings.autorespond),
this.saveSettings(),API.sendChat("@"+a.from+" AFK message disabled")):API.sendChat("@"+a.from+" AFK message was not enabled"))},U:function(a){a.fromID===API.getUser().id&&this.k.readyState===SockJS.OPEN&&this.k.send(JSON.stringify({type:"chat",msg:a.message,chatID:a.chatID}));a.fromID&&-1<this.settings.J.indexOf(a.fromID)&&(this.na(a),$(".chat-id-"+a.chatID).remove());this.na(a);if("mention"==a.type)this.settings.autorespond&&!this.settings.recent&&(this.settings.recent=f,setTimeout(function(){plugCubed.settings.recent=
l;plugCubed.saveSettings()},18E4),API.sendChat("@"+a.from+" "+this.settings.awaymsg));else for(var b in this.settings.la)-1<a.message.indexOf(this.settings.la[b])&&document.getElementById("chat-sound").playMentionSound();if(this.settings.j.enabled){a=$("#chat-messages").children("div");var c=a.length;b=0;a.each(function(){++b;var a=c-plugCubed.settings.j.limit-1;b<a?$(this).remove():b==a&&0==b%2&&$(this).remove()})}},u:function(){this.settings.userlist&&this.aa()},B:function(){this.history[1].ja=
f},Ua:function(a){var b=-1,c;for(c in this.history){var e=this.history[c];if(e.id==a&&51>~~c+2&&(b=~~c+2,!e.ja))return API.g("Song is in history ("+b+" of "+this.history.length+")",f)}if(0<b)return API.g("Song is in history ("+b+" of "+this.history.length+"), but was skipped on the last play",f)},S:function(){var a=new Date,b=a.getMinutes();return a.getHours()+":"+((10>b?"0":"")+b)},ba:[["/nick","change username"],["/avail","set status to available"],["/afk","set status to afk"],["/work","set status to working"],
["/sleep","set status to sleeping"],["/join","join dj booth/waitlist"],["/leave","leaves dj booth/waitlist"],["/whoami","get your own information"],["/mute","set volume to 0"],["/automute","register currently playing song to automatically mute on future plays"],["/unmute","set volume to last volume"],["/woot","woots current song"],["/meh","mehs current song"],["/refresh","refresh the video"],["/ignore (username)","ignore all chat messages from user"],["/alertson (word)","play mention sound whenever word is written in chat"],
["/curate","add current song to your selected playlist"],["/getpos","get current waitlist position"],["/version","displays version number"],["/commands","shows this list"],["/link","paste link to plugCubed website in chat"]],M:[["/whois (username)","gives general information about user",API.f.BOUNCER],["/skip","skip current song",API.f.BOUNCER],["/kick (username)","kicks targeted user",API.f.BOUNCER],["/lock","locks DJ booth",API.f.MANAGER],["/unlock","unlocks DJ booth",API.f.MANAGER],["/add (username)",
"adds targeted user to dj booth/waitlist",API.f.BOUNCER],["/remove (username)","removes targeted user from dj booth/waitlist",API.f.BOUNCER]],oa:function(a){if(0===a.indexOf("/commands"))return require(["plugCubed/dialog/commands","app/base/Context","app/events/ShowDialogEvent"],function(a,b,g){b.dispatch(new g(g.ca,new a))}),f;if("/avail"==a||"/available"==a)return API.N(0),f;if("/brb"==a||"/away"==a)return API.N(1),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=l,plugCubed.i("join",l),
plugCubed.saveSettings()),f;if("/work"==a||"/working"==a)return API.N(2),f;if("/sleep"==a||"/sleeping"==a)return API.N(3),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=l,plugCubed.i("join",l),plugCubed.saveSettings()),f;if("/join"==a)return API.qa(),f;if("/leave"==a)return API.Ka(),f;if("/whoami"==a)return plugCubed.T(API.getUser().id),f;if("/woot"==a)return $("#button-vote-positive").click(),f;if("/meh"==a)return $("#button-vote-negative").click(),f;if("/refresh"==a)return $("#button-refresh").click(),
f;if("/version"==a)return API.g(this.d("running",[plugCubed.version.toString()])),f;if("/mute"==a)return plugCubed.lastVolume=API.ra(),API.setVolume(0),f;if("/link"==a)return API.sendChat("plugCubed : http://tatdk.github.io/plugCubed"),f;if("/unmute"==a)return API.setVolume(plugCubed.lastVolume),f;if("/nextsong"==a){var b=API.fb();b===d?API.g(plugCubed.d("noNextSong")):b.ib?(API.g(plugCubed.d("nextsong",[b.title,b.author])),API.g(plugCubed.d("isHistory",[found,plugCubed.history.length]),f)):API.g(plugCubed.d("nextsong",
[b.title,b.author]))}if("/automute"==a){b=API.getMedia();if(b===d)return f;0>plugCubed.settings.z.indexOf(b.id)?(plugCubed.settings.z.push(b.id),plugCubed.settings.C=f,plugCubed.lastVolume=API.ra(),API.setVolume(0),API.g(b.title+" registered to auto-mute on future plays.")):(plugCubed.settings.z.splice(plugCubed.settings.z.indexOf(API.getMedia().id),1),plugCubed.settings.C=l,API.setVolume(plugCubed.lastVolume),API.g(b.title+" removed from automute registry."));plugCubed.saveSettings();return f}if("/alertsoff"==
a)return 1===(plugCubed.settings.notify&1)&&(b=$("#chat-messages"),a=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+plugCubed.colors.ea+'">'+plugCubed.d("notify.message.disabled")+"</span></div>"),a&&b.scrollTop(b[0].scrollHeight),plugCubed.settings.notify--,plugCubed.i("notify",l)),f;if("/alertson"==a)return 1!==(plugCubed.settings.notify&1)&&(b=$("#chat-messages"),a=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+
plugCubed.colors.ea+'">'+plugCubed.d("notify.message.enabled")+"</span></div>"),a&&b.scrollTop(b[0].scrollHeight),plugCubed.settings.notify++,plugCubed.i("notify",f)),f;if(0===a.indexOf("/getpos"))return b=plugCubed.getUser(a.substr(8)),b=b===h?API.getUser():b,a=API.getWaitListPosition(b.id),-1!=a?API.g(plugCubed.d("info.inwaitlist",[a,API.getWaitList.length])):(a=API.Ma(b.id),0>a?API.g(plugCubed.d("info.notinlist")):0===a?API.g(plugCubed.d("info.userDjing",[b.id===API.getUser().id?plugCubed.d("you"):
b.username])):1===a?API.g(plugCubed.d("info.userNextDJ",[b.id===API.getUser().id?plugCubed.d("you"):b.username])):API.g(plugCubed.d("info.inbooth",[a+1,API.getDJs().length]))),f;if(0===a.indexOf("/ignore ")||0===a.indexOf("/unignore "))return b=plugCubed.getUser(a.substr(8)),b===h?(API.g(plugCubed.d("error.userNotFound")),f):b.id===API.getUser().id?(API.g(plugCubed.d("error.ignoreSelf")),f):-1<plugCubed.settings.J.indexOf(b.id)?(plugCubed.settings.J.splice(plugCubed.settings.J.indexOf(b.id),1),plugCubed.saveSettings(),
API.g(plugCubed.d("ignore.disabled",[b.username])),f):(plugCubed.settings.J.push(b.id),plugCubed.saveSettings(),API.g(plugCubed.d("ignore.enabled",[b.username])),f);if(plugCubed.D(API.hb)&&0===a.indexOf("/whois "))return plugCubed.T(a.substr(7)),f;if(API.hasPermission(d,API.f.BOUNCER)){if(0===a.indexOf("/skip")){if(1>API.getDJs().length)return;if(0===API.Ma())Room.onSkipClick();else a=a.substr(5).trim(),b=plugCubed.getUser(API.getDJs()[0]),a&&API.sendChat((b!=h?"@"+b.username+" - ":"")+"Reason for skip: "+
a),API.moderateForceSkip();return f}if(0===a.indexOf("/whois "))return plugCubed.T(a.substr(7)),f;if(0===a.indexOf("/kick "))return 0<a.indexOf("::")?(a=a.substr(6).split(":: "),b=plugCubed.getUser(a[0]),API.moderateKickUser(b.id,a[1]),f):(plugCubed.fa(a.substr(6),"kick"),f);if(0===a.indexOf("/add "))return plugCubed.fa(a.substr(5),"adddj"),f;if(0===a.indexOf("/remove "))return plugCubed.fa(a.substr(8),"removedj"),f}if(API.hasPermission(d,API.f.MANAGER)){if("/lock"===a)return API.Sa(f,require("app/models/RoomModel").get("waitListEnabled")),
f;if("/unlock"===a)return API.Sa(l,require("app/models/RoomModel").get("waitListEnabled")),f}return l}});
if(localStorage.ga===d){var plugCubed=h;new (Class.extend({init:function(){$("#overlay-container").append($("#avatar-overlay").clone(l,l).attr("id","plugCubedLang-overlay").width(800).height(600).css("position","absolute"));$("#plugCubedLang-overlay").find(".overlay-title").html("plug&#179; language");$("#plugCubedLang-overlay").find("#avatar-sets").remove();$("#plugCubedLang-overlay").find("#avatar-panel").attr("id","plugCubedLang-panel").css("padding-top","60px");$("#plugCubedLang-overlay").find(".overlay-close-button").click($.proxy(this.hide,
this));this.Qa()},show:function(){$("#user-list-overlay").hide();$("#lobby-overlay").hide();$("#media-overlay").hide();$("#avatar-overlay").hide();$("#plugCubedLang-overlay").show();$("#overlay-container").show();this.draw()},hide:function(){$("#user-list-overlay").hide();$("#lobby-overlay").hide();$("#media-overlay").hide();$("#avatar-overlay").hide();$("#plugCubedLang-overlay").hide();$("#overlay-container").hide()},draw:function(){$("#plugCubedLang-panel").html("").scrollTop(0);var a=this.K.length,
b=$("<div/>");if(5<a)for(var c=0;c<a/5;c++)b.append(this.drawRow(this.K.slice(5*c,5*c+5)).css("top",75*c));else b.append(this.drawRow(this.K).css("top",75*c));$("#plugCubedLang-panel").append(b);$(".lang-button").click($.proxy(this.Va,this))},drawRow:function(a){for(var b=$("<div/>").addClass("lang-row"),c=a.length,e=5==c?0:4==c?75:3==c?150:2==c?225:300,g=0;g<c;++g){var m=$("<div/>").addClass("lang-button").css("display","inline-block").css("left",e).data("language",a[g].file).css("cursor","pointer").append($("<img/>").attr("src",
"http://tatdk.github.io/plugCubed/compiled/flags/flag."+a[g].file+".png").attr("alt",a[g].name).height(75).width(150));b.append(m);e+=150}return b},Va:function(a){a=$(a.currentTarget);localStorage.ga=a.data("language");plugCubed=new u;this.hide()},Qa:function(){var a=this;this.K=[];$.getJSON("http://tatdk.github.io/plugCubed/compiled/lang.txt",function(b){a.K=b;a.show()}).done(function(){0===a.K.length&&log('<span style="color:#FF0000">Error loading plugCubed</span>')})}}))}else plugCubed=new u;
//# sourceMappingURL=http://tatdk.github.io/plugCubed/compiled/plugCubed.min.js.map 
