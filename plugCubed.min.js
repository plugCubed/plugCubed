/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use and/or distribute this software or parts of it for any purpose without
 fee is hereby granted, provided that the above copyright notice and this permission notice
 appear in all copies.

 Permission to copy and/or edit this software or parts of it for any purpose is NOT permitted
 without written permission by the authors.

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
var d=void 0,e=!0,f=null,h=!1;"undefined"!==typeof plugCubed&&plugCubed.close();Math.Pa=function(){return 1+Math.floor(10*Math.random())};Emoji.G=Emoji.emojify;console.info=function(a){console.log(a);n!==d?(log('<span style="color:#FF0000">Disconnected at '+plugCubed.P()+"! Reloading the page in a few seconds.</span>"),setTimeout(function(){location.reload(e)},3E3)):log('<span style="color:#FF0000">Disconnected at '+plugCubed.P()+"! </span>")};
var n,plugCubed=new (Class.extend({J:{},O:function(){return"undefined"!==typeof pdpSocket&&"http://socket.plugpony.net:9000/gateway"===pdpSocket._base_url},version:{major:1,minor:6,patch:2},init:function(){"undefined"===typeof jQuery.fn.tabs&&($.getScript("http://code.jquery.com/ui/1.10.2/jquery-ui.js"),$("head").append('<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />'));this.pa=h;this.proxy={menu:{ba:$.proxy(this.ba,this),aa:$.proxy(this.aa,this),
ha:$.proxy(this.ha,this),Z:$.proxy(this.Z,this),fa:$.proxy(this.fa,this),ga:$.proxy(this.ga,this),ca:$.proxy(this.ca,this),da:$.proxy(this.da,this),ea:$.proxy(this.ea,this)},T:$.proxy(this.T,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),S:$.proxy(this.S,this),U:$.proxy(this.U,this),V:$.proxy(this.V,this),R:$.proxy(this.R,this),g:$.proxy(this.g,this),u:$.proxy(this.u,this)};this.colors={Qa:"66FFFF",qa:"FF0000",C:"FFFF00",f:"66FFFF"};this.ma="I'm away from keyboard.";setTimeout(function(){plugCubed.history=
[];plugCubed.Da()},1);this.N=$('<style type="text/css"></css>');$("head").append(this.N);this.log("Running plug&#179; version "+this.version.major+"."+this.version.minor+"."+this.version.patch,f,this.colors.C);this.log("Use '/commands' to see expanded chat commands.",f,this.colors.f);Dialog.ta=function(a,b){this.closeDialog();var c=a;b!==d&&(c='<div id="plugCubedCommands"><ul><li><a href="#user">User Commands</a></li><li><a href="#mod">Moderation Commands</a></li></ul><div id="user">'+a+'</div><div id="mod">'+
b+"</div></div>");this.showDialog($("<div/>").attr("id","dialog-alert").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-620-15)/2).css("top",200).width(645).height(470).append(this.getHeader("plug&#179; Commands")).append($("<div/>").addClass("dialog-body").append(this.getMessage(c).width(620))));$("#plugCubedCommands").tabs()};Models.chat.F===d&&(Models.chat.F=Models.chat.chatCommand);ChatModel.F===d&&(ChatModel.F=ChatModel.chatCommand);Models.chat.chatCommand=this.la;ChatModel.chatCommand=this.la;
this.Ha();$("body").prepend('<link rel="stylesheet" type="text/css" id="plugcubed-css" href="http://tatdk.github.io/plugCubed/compiled/plugCubed.css" />');$("body").append('<div id="side-left" class="sidebar"><div class="sidebar-content"></div></div><div id="side-right" class="sidebar"><div class="sidebar-handle"><span>||</span></div><div class="sidebar-content"></div></div>').append('<script type="text/javascript" src="http://tatdk.github.io/plugCubed/compiled/thirdparty.js">\x3c/script>');this.Fa();
this.Ea();this.settings.userlist?(this.W(),this.ia()):this.na();var a=API.getUsers(),b;for(b in a){var c=a[b];c.z===d&&(c.z=0);c.D===d&&(c.D=0);c.B===d&&(c.B=0);c.joinTime===d&&(c.joinTime=this.P())}this.k=new SockJS("http://socket.plugpony.net:923/gateway");this.k.L=0;this.k.onopen=function(){this.L=0;this.send(JSON.stringify({id:Models.user.data.id,username:Models.user.data.username,version:plugCubed.version.major+"."+plugCubed.version.minor+"."+plugCubed.version.patch}))};this.k.onmessage=function(a){"update"===
JSON.parse(a.data).type&&(plugCubed.k.onclose=function(){},plugCubed.k.close(),plugCubed.log("A new version of plug&#179; has been released. Your script will reload in a few seconds.",f,plugCubed.colors.C),setTimeout(function(){$.getScript("http://tatdk.github.io/plugCubed/compiled/plugCubed."+(plugCubed.pa?"min.":"")+"js")},5E3))};this.k.onclose=function(){this.L++;var a;if(5>this.L)a=5;else if(30>this.L)a=30;else if(60>this.L)a=60;else return;setTimeout(function(){plugCubed.k=new SockJS("http://socket.plugpony.net:923/gateway")},
1E3*a)};SocketListener.chat=function(a){"undefined"!==typeof plugCubed&&a.fromID&&-1<plugCubed.settings.K.indexOf(a.fromID)||(Models.chat.receive(a),API.delayDispatch(API.CHAT,a))}},close:function(){Models.chat.chatCommand=Models.chat.F;ChatModel.chatCommand=ChatModel.F;API.removeEventListener(API.DJ_ADVANCE,this.proxy.T);API.removeEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.removeEventListener(API.CURATE_UPDATE,this.proxy.S);API.removeEventListener(API.USER_JOIN,this.proxy.U);API.removeEventListener(API.USER_LEAVE,
this.proxy.V);API.removeEventListener(API.CHAT,this.proxy.R);API.removeEventListener(API.VOTE_SKIP,this.proxy.u);API.removeEventListener(API.USER_SKIP,this.proxy.u);API.removeEventListener(API.MOD_SKIP,this.proxy.u);API.removeEventListener(API.WAIT_LIST_UPDATE,this.proxy.g);API.removeEventListener("userUpdate",this.proxy.g);for(var a in plugCubed.J)a===d||plugCubed.J[a]===d||($("#plugcubed-btn-"+a).unbind(),delete plugCubed.J[a]);$("#plugcubed-css").remove();$("#plugcubed-js-extra").remove();$("#side-right").remove();
$("#side-left").remove();this.N.remove();this.k.onclose=function(){};this.k.close();delete plugCubed},ia:function(){$("#side-left").show().animate({left:"0px"},300,"undefined"===typeof jQuery.easing.Ca?d:"easeOutQuart");this.O()&&(userlistShow===e&&$("#pdpUsers").hide(),$("#pdpUsersToggle").hide())},na:function(){var a=-$("#side-left").width()-20;$("#side-left").animate({left:a+"px"},300,"undefined"===typeof jQuery.easing.Ca?d:"easeOutQuart",function(){$("#side-left").hide()});this.O()&&(userlistShow===
e&&$("#pdpUsers").show(),$("#pdpUsersToggle").show())},X:{you:{title:"You",color:"FFDD6F"},regular:{title:"Regular",color:"B0B0B0"},featureddj:{title:"Featured DJ",color:"E90E82"},bouncer:{title:"Bouncer",color:"E90E82"},manager:{title:"Manager",color:"E90E82"},cohost:{title:"Co-Host",color:"E90E82"},host:{title:"Host",color:"E90E82"},ambassador:{title:"Ambassador",color:"9A50FF"},admin:{title:"Admin",color:"42A5DC"},join:{title:"User Join",color:"3366FF"},leave:{title:"User Leave",color:"3366FF"},
curate:{title:"User Curate",color:"00FF00"},xa:{title:"Song Stats",color:"66FFFF"},za:{title:"Song Updates",color:"FFFF00"}},settings:{recent:h,awaymsg:"",autowoot:h,autojoin:h,userlist:h,autorespond:h,menu:h,notify:h,customColors:h,H:e,q:{enabled:h,limit:50},colors:{you:"FFDD6F",regular:"B0B0B0",featureddj:"E90E82",bouncer:"E90E82",manager:"E90E82",cohost:"E90E82",host:"E90E82",ambassador:"9A50FF",admin:"42A5DC",join:"3366FF",leave:"3366FF",curate:"00FF00",xa:"66FFFF",za:"FFFF00"},alerts:{join:h,
leave:h,curate:h,wa:h,va:h},j:[],K:[],A:h},Ha:function(){if(localStorage.ra!==d){var a=JSON.parse(localStorage.ra),b;for(b in this.settings)a[b]!==d&&(this.settings[b]=a[b]);this.settings.recent=h;this.settings.autowoot&&this.Aa();this.settings.userlist&&(this.W(),this.ia());this.settings.customColors&&this.ya();0<this.settings.j.length&&-1<this.settings.j.indexOf(Models.room.data.media.id)&&(Playback.setVolume(0),this.settings.A=e,this.log(Models.room.data.media.title+" auto-muted.",f,this.colors.f));
this.settings.H||(Emoji.G===d&&(Emoji.G=Emoji.emojify),Emoji.emojify=function(a){return a})}},saveSettings:function(){localStorage.ra=JSON.stringify(this.settings)},ya:function(){this.settings.customColors?this.N.text([".chat-message .chat-from,",".chat-mention .chat-from { color:#"+this.settings.colors.regular+"!important; }",".chat-message .chat-from-featureddj,",".chat-mention .chat-from-featureddj { color:#"+this.settings.colors.featureddj+"!important; }",".chat-message .chat-from-bouncer,",".chat-mention .chat-from-bouncer { color:#"+
this.settings.colors.bouncer+"!important; }",".chat-message .chat-from-manager,",".chat-mention .chat-from-manager { color:#"+this.settings.colors.manager+"!important; }",".chat-message .chat-from-cohost,",".chat-mention .chat-from-cohost { color:#"+this.settings.colors.cohost+"!important; }",".chat-message .chat-from-host,",".chat-mention .chat-from-host { color:#"+this.settings.colors.host+"!important; }",".chat-message .chat-from-ambassador,",".chat-mention .chat-from-ambassador { color:#"+this.settings.colors.ambassador+
"!important; }",".chat-message .chat-from-admin,",".chat-mention .chat-from-admin { color:#"+this.settings.colors.admin+"!important; }",".chat-message .chat-from-you,",".chat-mention .chat-from-you { color:#"+this.settings.colors.you+"!important; }"].join("\n")):this.N.text("")},Ea:function(){API.addEventListener(API.DJ_ADVANCE,this.proxy.T);API.addEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.addEventListener(API.CURATE_UPDATE,this.proxy.S);API.addEventListener(API.USER_JOIN,this.proxy.U);
API.addEventListener(API.USER_LEAVE,this.proxy.V);API.addEventListener(API.CHAT,this.proxy.R);API.addEventListener(API.VOTE_SKIP,this.proxy.u);API.addEventListener(API.USER_SKIP,this.proxy.u);API.addEventListener(API.MOD_SKIP,this.proxy.u);API.addEventListener(API.WAIT_LIST_UPDATE,this.proxy.g);API.addEventListener("userUpdate",this.proxy.g)},Fa:function(){this.i(this.settings.autowoot,"woot","Autowoot",this.proxy.menu.ba);this.i(this.settings.autojoin,"join","Autojoin",this.proxy.menu.aa);this.i(this.settings.userlist,
"userlist","Userlist",this.proxy.menu.ha);this.i(this.settings.customColors,"colors","Custom Chat Colors",this.proxy.menu.da);this.i(this.settings.autorespond,"autorespond","AFK Status",this.proxy.menu.Z);this.i(this.settings.notify,"notify","Notify",this.proxy.menu.fa);this.i(this.settings.q.enabled,"chatlimit","Limit Chat Log",this.proxy.menu.ca);this.i(!DB.settings.streamDisabled,"stream","Stream",this.proxy.menu.ga);this.i(this.settings.H,"emoji","Emoji",this.proxy.menu.ea)},i:function(a,b,c,
g){this.J[b]===d&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+b+'"><div class="status-'+(a?"on":"off")+'"></div>'+c+"</a>"),$("#plugcubed-btn-"+b).click(g),this.J[b]={text:c,callback:g})},d:function(a,b){$("#plugcubed-btn-"+a).find('[class^="status-"], [class*=" status-"]').attr("class","status-"+(b===e?"on":"off"))},W:function(){0<$("#side-left .sidebar-content").children().length&&
$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").bind("contextmenu",function(){return h});$("#side-left .sidebar-content").html('<h1 class="users">Users: '+API.getUsers().length+"</h1>");var a=Models.room.getWaitListPosition(),a=$("<h3></h3>").addClass("waitlistspot").text("Waitlist: "+(a!==f?a+" / ":"")+Models.room.data.waitList.length);$("#side-left .sidebar-content").append(a).append("<hr />");var a=API.getUsers(),b;for(b in a)this.Ba(a[b])},log:function(a,b,c,
g){var k="";c&&(k=' style="color:'+("#"===c.substr(0,1)?c:"#"+c)+';"');a=b?'<div class="chat-message"><span class="chat-from"'+k+">"+b+'</span><span class="chat-text"'+k+">: "+a+"</span></div>":'<div class="chat-message"><span class="chat-text"'+k+">"+a+"</span></div>";$("#chat-messages");$("#chat-messages").scrollTop();$("#chat-messages").outerHeight();b=Popout?Popout.Chat.chatMessages:Chat.chatMessages;c=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append(a);c&&b.scrollTop(b[0].scrollHeight);
g&&$(a).click(function(){this.childNodes[0].style.color=g})},Ba:function(a){var b=Utils.cleanTypedString(a.username),c;c=a.curated==e?"curate":this.I(a.id)?"plugcubed":this.oa(a.id)?"vip":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.FEATUREDDJ?"fdj":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?"bouncer":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?"manager":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==
Models.user.COHOST?"host":Models.room.data.staff[a.id]&&5==Models.room.data.staff[a.id]?"host":Models.room.ambassadors[a.id]?"ambassador":Models.room.admins[a.id]?"admin":"normal";0<Models.room.data.djs.length&&Models.room.data.djs[0].user.id==a.id?"normal"===c?this.M("void","#66FFFF",b):this.M(c+"_current","#66FFFF",b):"normal"===c?this.M("void",this.ka(a.vote),b):this.M(c+this.Oa(a.vote),this.ka(a.vote),b)},ka:function(a){var b="";if(a===d)b="FFFFFF";else switch(a){case -1:b="ED1C24";break;case 1:b=
"3FFF00";break;default:b="FFFFFF"}return"#"+b},Oa:function(a){var b="";if(a===d)b="undecided";else switch(a){case -1:b="meh";break;case 1:b="woot";break;default:b="undecided"}return"_"+b},M:function(a,b,c){$("#side-left .sidebar-content").append($("<p></p>").append($("<span></span>").append($("<span></span>").addClass(a)).css("cursor","pointer").css("color",b).mousedown(function(a){switch(a.which){case 1:$("#chat-input-field").val($("#chat-input-field").val()+"@"+c+" ").focus();break;case 3:(Models.room.data.staff[Models.user.data.id]&&
Models.room.data.staff[Models.user.data.id]>=Models.user.BOUNCER||plugCubed.I(Models.user.data.id))&&plugCubed.Q(c)}}).html(function(a,b){return b+c})))},getUser:function(a){a=a.trim();"@"===a.substr(0,1)&&(a=a.substr(1));var b=API.getUsers(),c;for(c in b)if(("string"!==typeof a?0:b[c].username.toLowerCase()===a.toLowerCase())||("string"!==typeof a?0:b[c].id.toLowerCase()===a.toLowerCase()))return b[c];return f},Y:function(a,b){if(Models.room.data.staff[Models.user.data.id]&&Models.room.data.staff[Models.user.data.id]>=
Models.user.BOUNCER){var c;switch(b){case "kick":c=ModerationKickUserService;break;case "removedj":c=ModerationRemoveDJService;break;case "adddj":c=ModerationAddDJService;break;default:log("Unknown moderation");return}var g=this.getUser(a);g===f?log("User not found"):new c(g.id," ")}},Q:function(a){a=this.getUser(a);if(a===f)log("User not found");else{var b,c,g,k,p=a.djPoints+a.curatorPoints+a.listenerPoints,m=a.z+a.D;c=Models.room.getWaitListPosition(a.id);var l=-1;b=Models.room.data.staff[a.id]&&
Models.room.data.staff[a.id]==Models.user.FEATUREDDJ?"Featured DJ":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?"Bouncer":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?"Manager":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.COHOST?"Co-Host":Models.room.data.staff[a.id]&&5==Models.room.data.staff[a.id]?"Host":Models.room.ambassadors[a.id]?"Ambassador":Models.room.admins[a.id]?"Admin":"User";if(c===f)if(0<
Models.room.data.djs.length&&Models.room.data.djs[0].user.id===a.id)k="Currently DJing",l=0;else{for(c=1;c<Models.room.data.djs.length;c++)l=Models.room.data.djs[c].user.id===a.id?c:l;k=0>l?"Not in waitlist nor booth":l+1+"/"+Models.room.data.djs.length+" in booth"}else k=c+"/"+Models.room.data.waitList.length+" in waitlist";switch(a.status){case -1:c="Idle";break;default:c="Available";break;case 1:c="AFK";break;case 2:c="Working";break;case 3:c="Sleeping"}switch(a.vote){case -1:g="Meh";break;default:g=
"Undecided";break;case 1:g="Woot"}0===l&&(g="DJing");log('<table style="width:100%;color:#CC00CC"><tr><td colspan="2"><strong>Name</strong>: <span style="color:#FFFFFF">'+a.username+"</span></td></tr>"+(this.I(a.id)?'<tr><td colspan="2"><strong>Title</strong>: <span style="color:#FFFFFF">plugCubed Developer</span></td></tr>':"")+(this.oa(a.id)?'<tr><td colspan="2"><strong>Title</strong>: <span style="color:#FFFFFF">plugCubed VIP</span></td></tr>':"")+'<tr><td colspan="2"><strong>ID</strong>: <span style="color:#FFFFFF">'+
a.id+'</span></td></tr><tr><td><strong> Rank</strong>: <span style="color:#FFFFFF">'+b+'</span></td><td><strong>Time Joined</strong>: <span style="color:#FFFFFF">'+a.joinTime+'</span></td></tr><tr><td><strong>Status</strong>: <span style="color:#FFFFFF">'+c+'</span></td><td><strong> Vote</strong>: <span style="color:#FFFFFF">'+g+'</span></td></tr><tr><td colspan="2"><strong>Position</strong>: <span style="color:#FFFFFF">'+k+'</span></td></tr><tr><td><strong>Points</strong>: <span style="color:#FFFFFF" title = "'+
a.djPoints+"  DJ Points  +  "+a.listenerPoints+"  Listener Points  +  "+a.curatorPoints+'  Curator Points">'+p+'</span></td><td><strong> Fans</strong>: <span style="color:#FFFFFF">'+a.fans+'</span></td></tr><tr><td><strong>Woot Count</strong>: <span style="color:#FFFFFF">'+a.z+'</span></td><td><strong>Meh Count</strong>: <span style="color:#FFFFFF">'+a.D+'</span></td></tr><tr><td colspan="2"><strong>Woot/Meh ratio</strong>: <span style="color:#FFFFFF">'+(0===m?"0":(a.z/m).toFixed(2))+"</span></td></tr></table>")}},
ba:function(){this.settings.autowoot=!this.settings.autowoot;this.d("woot",this.settings.autowoot);this.settings.autowoot&&$("#button-vote-positive").click();this.saveSettings()},aa:function(){this.settings.autojoin=!this.settings.autojoin;this.d("join",this.settings.autojoin);this.settings.autojoin&&0<$("#button-dj-waitlist-join").length&&API.waitListJoin();this.saveSettings()},ha:function(){this.settings.userlist=!this.settings.userlist;this.d("userlist",this.settings.userlist);this.settings.userlist?
(this.W(),this.ia()):($("#side-left .sidebar-content").empty(),this.na());this.saveSettings()},Z:function(){this.settings.autorespond=!this.settings.autorespond;this.d("autorespond",this.settings.autorespond);if(this.settings.autorespond){var a=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.awaymsg?this.ma:this.settings.awaymsg);if(a===f){this.settings.autorespond=h;this.d("autorespond",h);return}a=a.split("@").join("").trim();this.settings.awaymsg=
""===a?this.ma:a;0>=Models.user.data.status&&Models.user.changeStatus(1)}else Models.user.changeStatus(0);this.saveSettings()},fa:function(){Dialog.closeDialog();Dialog.context="isNotifySettings";Dialog.submitFunc=$.proxy(this.Na,this);Dialog.showDialog($("<div/>").attr("id","dialog-notify").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Chat Notifications")).append($("<div/>").addClass("dialog-body").append($("<form/>").submit("return false").append(Dialog.getCheckBox("Enable alerts",
"enabled",this.settings.notify).css("top",10).css("left",10)).append(Dialog.getCheckBox("User Join","join",this.settings.alerts.join).css("top",30).css("left",30)).append(Dialog.getCheckBox("User Leave","leave",this.settings.alerts.leave).css("top",50).css("left",30)).append(Dialog.getCheckBox("User Curate","curate",this.settings.alerts.curate).css("top",70).css("left",30)).append(Dialog.getCheckBox("Song Stats","songStats",this.settings.alerts.va).css("top",90).css("left",30)).append(Dialog.getCheckBox("Song Updates",
"songUpdate",this.settings.alerts.wa).css("top",110).css("left",30)))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)))},Na:function(){this.settings.notify=$("#dialog-checkbox-enabled").is(":checked");for(var a in this.settings.alerts)this.settings.alerts[a]=$("#dialog-checkbox-"+a).is(":checked");this.d("notify",this.settings.notify);this.saveSettings();Dialog.closeDialog()},ca:function(){Dialog.closeDialog();Dialog.context="isChatLimitSettings";Dialog.submitFunc=
$.proxy(this.Ia,this);Dialog.showDialog($("<div/>").attr("id","dialog-chat-limit").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Limit Chat Log")).append($("<div/>").addClass("dialog-body").append($("<form/>").submit("return false").append(Dialog.getCheckBox("Enable","enabled",this.settings.q.enabled).css("top",10).css("left",10)).append(Dialog.getInputField("chat-limit","Limit",0,this.settings.q.limit).css("top",30).css("left",10)))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)))},
Ia:function(){this.settings.q.enabled=$("#dialog-checkbox-enabled").is(":checked");this.settings.q.limit=~~$('input[name="chat-limit"]').val();this.d("chatlimit",this.settings.q.enabled);this.saveSettings();Dialog.closeDialog()},ga:function(){this.d("stream",DB.settings.streamDisabled);API.sendChat(DB.settings.streamDisabled?"/stream on":"/stream off")},ea:function(){this.settings.H=!this.settings.H;this.d("emoji",this.settings.H);if(this.settings.H){if(Emoji.G===d)return this.log("Error in reenabling Emoji",
f,this.colors.qa);Emoji.emojify=Emoji.G}else Emoji.G===d&&(Emoji.G=Emoji.emojify),Emoji.emojify=function(a){return a};this.saveSettings()},da:function(){Dialog.closeDialog();var a=$("<form/>").submit("return false").append(Dialog.getCheckBox("Enable custom","enabled",this.settings.customColors)),b=0,c;for(c in this.X)a.append($(Dialog.getInputField(c,this.X[c].title,this.X[c].color,this.settings.colors[c],6).css("top",30*++b)).change(function(){$(this).find(".dialog-input-label").css("color","#"+
$(this).find("input").val())}));a=$("<div/>").addClass("dialog-body").append(a);for(c in this.settings.colors)a.find('input[name="'+c+'"]').parents(".dialog-input-container").find(".dialog-input-label").css("color","#"+this.settings.colors[c]);Dialog.context="isCustomChatColors";Dialog.submitFunc=$.proxy(this.Ka,this);Dialog.showDialog($("<div/>").attr("id","dialog-custom-colors").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Custom Chat Colors")).append(a).append($("<div/>").addClass("dialog-button dialog-default-button").click($.proxy(this.Ja,
this)).append($("<span/>").text("Default"))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)))},Ja:function(){for(var a in this.settings.colors){var b=$('input[name="'+a+'"]');b.val(b.data("ph"));b.parents(".dialog-input-container").find(".dialog-input-label").css("color","#"+b.val())}},Ka:function(){this.settings.customColors=$("#dialog-checkbox-enabled").is(":checked");for(var a in this.settings.colors){var b=$('input[name="'+a+'"]'),c=this.settings.colors,g=a,k;
if(!(k=""===b.val()))k=b.val(),k=!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test("#"===k.substr(0,1)?k:"#"+k);c[g]=k?b.data("ph"):b.val()}this.ya();this.d("colors",this.settings.customColors);this.saveSettings();Dialog.closeDialog()},onVoteUpdate:function(a){if(a&&a.user){var b=Models.room.userHash[a.user.id];this.g();1===b.B?b.z--:-1===b.B&&b.D--;1===a.vote?b.z++:-1===a.vote&&b.D++;b.B=a.vote}},S:function(a){var b=API.getMedia();this.settings.notify===e&&this.settings.alerts.curate===e&&this.log(a.user.username+
" added "+b.author+" - "+b.title,f,this.settings.colors.curate);Models.room.userHash[a.user.id].curated=e;this.g()},T:function(a){this.settings.notify===e&&(this.settings.alerts.va===e&&this.log("Stats:   "+a.lastPlay.score.positive+" woots -- "+a.lastPlay.score.negative+" mehs -- "+a.lastPlay.score.curates+" curates",f,this.settings.colors.xa),this.settings.alerts.wa===e&&this.log("Now Playing: "+a.media.title+" by "+a.media.author+"<br />Played by: "+a.dj.username,f,this.settings.colors.za));setTimeout($.proxy(this.La,
this),1E3*Math.Pa());(Models.user.getPermission()>=Models.user.BOUNCER||this.I(Models.user.data.id))&&this.Ma(a.media.id);plugCubed.history.unshift({id:a.media.id,author:a.media.author,title:a.media.title,ja:h,user:{id:a.dj.id,username:a.dj.username}});plugCubed.history.splice(50,plugCubed.history.length-50);this.settings.A&&0>this.settings.j.indexOf(a.media.id)&&(setTimeout(function(){Playback.setVolume(Playback.lastVolume)},800),this.settings.A=h);!this.settings.A&&-1<this.settings.j.indexOf(a.media.id)&&
(setTimeout(function(){Playback.setVolume(0)},800),this.settings.A=e,this.log(a.media.title+" auto-muted.",f,this.colors.f));this.g();a=API.getUsers();for(var b in a)a[b].B=0},La:function(){this.settings.autowoot&&0>this.settings.j.indexOf(Models.room.data.media.id)&&this.Aa();if("block"===$("#button-dj-waitlist-join").css("display")&&this.settings.autojoin)Room.onWaitListJoinClick()},Aa:function(){if(0!==Models.room.data.djs.length){var a=Models.room.data.djs[0];a===f||a==API.getSelf()||$("#button-vote-positive").click()}},
U:function(a){this.settings.notify===e&&this.settings.alerts.join===e&&this.log(Utils.cleanTypedString(a.username+" joined the room"),f,this.settings.colors.join);a=Models.room.userHash[a.id];a.z===d&&(a.z=0);a.D===d&&(a.D=0);a.B===d&&(a.B=0);a.joinTime===d&&(a.joinTime=this.P());this.g()},V:function(a){this.settings.notify===e&&this.settings.alerts.leave===e&&this.log(Utils.cleanTypedString(a.username+" left the room"),f,this.settings.colors.leave);this.g()},I:function(a){return"50aeb31696fba52c3ca0adb6"==
a||"50aeb077877b9217e2fbff00"==a},oa:function(a){return"5112c273d6e4a94ec0554792"==a||"50b1961c96fba57db2230417"==a},R:function(a){var b=0>a.message.indexOf("@")&&this.I(a.fromID);if("mention"==a.type&&Models.room.data.staff[a.fromID]&&Models.room.data.staff[a.fromID]>=Models.user.BOUNCER||b)if(-1<a.message.indexOf("!disable")&&(this.settings.autojoin?(this.settings.autojoin=h,this.d("join",this.settings.autojoin),this.saveSettings(),API.waitListLeave(),API.sendChat("@"+a.from+" Autojoin disabled")):
API.sendChat("@"+a.from+" Autojoin was not enabled")),-1<a.message.indexOf("!afkdisable")&&(this.settings.autorespond?(this.settings.autorespond=h,this.d("autorespond",this.settings.autorespond),this.saveSettings(),API.sendChat("@"+a.from+" AFK message disabled")):API.sendChat("@"+a.from+" AFK message was not enabled")),0<a.message.indexOf("!disable")||0<a.message.indexOf("!afkdisable"))return;"mention"==a.type&&(this.settings.autorespond&&!this.settings.recent)&&(this.settings.recent=e,setTimeout(function(){plugCubed.settings.recent=
h;plugCubed.saveSettings()},18E4),API.sendChat("@"+a.from+" "+this.settings.awaymsg));if(this.settings.q.enabled){a=$("#chat-messages").children("div");var c=a.length,g=0;a.each(function(){++g<c-plugCubed.settings.q.limit&&$(this).remove()})}},g:function(){this.settings.userlist&&this.W()},Da:function(){(new HistorySelectService).successCallback=$.proxy(this.Ga,this)},Ga:function(a){plugCubed.history=[];for(var b in a){var c=a[b];plugCubed.history.push({id:c.media.id,author:c.media.author,title:c.media.title,
ja:h,user:{id:c.user.id.toString(),username:c.user.username}})}},u:function(){plugCubed.history[1].ja=e},Ma:function(a){var b=-1,c;for(c in plugCubed.history){var g=plugCubed.history[c];if(g.id==a&&51>~~c+2&&(b=~~c+2,!g.ja))return document.getElementById("chat-sound").playMentionSound(),setTimeout(function(){document.getElementById("chat-sound").playMentionSound()},100),Models.chat.onChatReceived({type:"system",message:"Song is in history ("+b+" of "+plugCubed.history.length+")",language:Models.user.data.language})}if(0<
b)return document.getElementById("chat-sound").playMentionSound(),setTimeout(function(){document.getElementById("chat-sound").playMentionSound()},100),Models.chat.onChatReceived({type:"system",message:"Song is in history ("+b+" of "+plugCubed.history.length+"), but was skipped on the last play",language:Models.user.data.language})},P:function(){var a=new Date,b=a.getMinutes();return a.getHours()+":"+((10>b?"0":"")+b)},la:function(a){if(Models.chat.F(a)===e)return("/stream on"==a||"/stream off"==a)&&
plugCubed.d("stream",!DB.settings.streamDisabled),"/afk"==a&&plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.d("join",h),plugCubed.saveSettings()),e;if(0===a.indexOf("/commands")){a=[["/nick","change username"],["/idle","set status to idle"],["/avail","set status to available"],["/afk","set status to afk"],["/work","set status to working"],["/sleep","set status to sleeping"],["/join","join dj booth/waitlist"],["/leave","leaves dj booth/waitlist"],["/whoami","get your own information"],
["/mute","set volume to 0"],["/automute","register currently playing song to automatically mute on future plays"],["/unmute","set volume to last volume"],["/woot","woots current song"],["/meh","mehs current song"],["/refresh","refresh the video"],["/ignore (username)","ignore all chat messages from user"],["/curate","add current song to your selected playlist"],["/getpos","get current waitlist position"],["/version","displays version number"],["/commands","shows this list"]];var b="<table>",c;for(c in a)b+=
"<tr><td>"+a[c][0]+"</td><td>"+a[c][1]+"</td></tr>";b+="</table>";if(Models.user.hasPermission(Models.user.BOUNCER)){a=[["/whois (username)","gives general information about user",Models.user.BOUNCER],["/skip","skip current song",Models.user.BOUNCER],["/kick (username)","kicks targeted user",Models.user.BOUNCER],["/lock","locks DJ booth",Models.user.MANAGER],["/unlock","unlocks DJ booth",Models.user.MANAGER],["/add (username)","adds targeted user to dj booth/waitlist",Models.user.BOUNCER],["/remove (username)",
"removes targeted user from dj booth/waitlist",Models.user.BOUNCER]];var g="<table>";for(c in a)Models.user.hasPermission(a[c][2])&&(g+="<tr><td>"+a[c][0]+"</td><td>"+a[c][1]+"</td></tr>");Dialog.ta(b,g+"</table>")}else Dialog.ta(b);return e}if("/idle"==a)return Models.user.changeStatus(-1),e;if("/avail"==a||"/available"==a)return Models.user.changeStatus(0),e;if("/brb"==a||"/away"==a)return Models.user.changeStatus(1),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.d("join",
h),plugCubed.saveSettings()),e;if("/work"==a||"/working"==a)return Models.user.changeStatus(2),e;if("/sleep"==a||"/sleeping"==a)return Models.user.changeStatus(3),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.d("join",h),plugCubed.saveSettings()),e;if("/join"==a)return Room.onWaitListJoinClick(),e;if("/leave"==a)return API.waitListLeave(),e;if("/whoami"==a)return plugCubed.Q(Models.user.data.id),e;if("/woot"==a)return $("#button-vote-positive").click(),e;if("/meh"==a)return $("#button-vote-negative").click(),
e;if("/refresh"==a)return $("#button-refresh").click(),e;if("/version"==a)return plugCubed.log("Running plug&#179; version "+plugCubed.version.major+"."+plugCubed.version.minor+"."+plugCubed.version.patch,f,plugCubed.colors.C),e;if("/mute"==a)return Playback.setVolume(0),e;if("/unmute"==a)return Playback.setVolume(Playback.lastVolume),e;if(plugCubed.O()&&"/muteone"==a||plugCubed.O()&&"/singlemute"==a)return $("#button-sound").click(),$("#button-sound").click(),e;if(0===a.indexOf("/nick "))return Models.user.changeDisplayName(a.substr(6)),
e;if(0===a.indexOf("/curate"))return new DJCurateService(Models.playlist.selectedPlaylistID),setTimeout(function(){Dialog.closeDialog()},500),e;if("/nextsong"==a){a=Models.playlistMedia(Models.playlist.selectedPlaylistID).data[0];a.id===Models.room.data.media.id&&Models.room.data.currentDJ===Models.user.data.id&&(a=Models.playlistMedia(Models.playlist.selectedPlaylistID).data[1]);b=-1;for(c in plugCubed.history)if(plugCubed.history[c].id==a.id&&51>~~c+1){b=~~c+1;break}return 0<b?(log('<span style="color:'+
plugCubed.colors.C+'">Your next queued song is '+a.title+" by "+a.author+'</span><br /><span style="color:'+plugCubed.colors.qa+'"><strong> Warning: This song is still in the history ('+b+" of "+plugCubed.history.length+")</strong></span>"),e):(plugCubed.log("Your next queued song is "+a.title+" by "+a.author,f,plugCubed.colors.C),e)}if("/automute"==a)return 0>plugCubed.settings.j.indexOf(Models.room.data.media.id)?(plugCubed.settings.j.push(Models.room.data.media.id),plugCubed.settings.A=e,Playback.setVolume(0),
plugCubed.log(Models.room.data.media.title+" registered to auto-mute on future plays.",f,plugCubed.colors.f)):(plugCubed.settings.j.splice(plugCubed.settings.j.indexOf(Models.room.data.media.id),1),plugCubed.settings.A=h,Playback.setVolume(Playback.lastVolume),plugCubed.log(Models.room.data.media.title+" removed from automute registry.",f,plugCubed.colors.f)),plugCubed.saveSettings(),e;if("/alertsoff"==a)return plugCubed.settings.notify&&(plugCubed.log("Join/leave alerts disabled",f,plugCubed.colors.C),
plugCubed.settings.notify=h,plugCubed.d("notify",h)),e;if("/alertson"==a)return plugCubed.settings.notify||(plugCubed.log("Join/leave alerts enabled",f,plugCubed.colors.C),plugCubed.settings.notify=e,plugCubed.d("notify",e)),e;if(0===a.indexOf("/getpos")){c=plugCubed.getUser(a.substr(8));a=c===f?Models.user.data:c;b=Models.room.getWaitListPosition(a.id);if(b!==f)plugCubed.log("Position in waitlist "+b+"/"+Models.room.data.waitList.length,f,plugCubed.colors.f);else{b=-1;for(c=0;c<Models.room.data.djs.length;c++)b=
Models.room.data.djs[c].user.id===a.id?c:b;0>b?plugCubed.log("Not in waitlist nor booth",f,plugCubed.colors.f):0===b?plugCubed.log((a.id===Models.user.data.id?"You":a.username)+" are currently DJing",f,plugCubed.colors.f):1===b?plugCubed.log((a.id===Models.user.data.id?"You":a.username)+" are DJing next",f,plugCubed.colors.f):plugCubed.log("Position in booth "+(b+1)+"/"+Models.room.data.djs.length,f,plugCubed.colors.f)}return e}if(0===a.indexOf("/ignore "))return a=plugCubed.getUser(a.substr(8)),
a===f?(plugCubed.log("User not found",f,plugCubed.colors.f),e):a.id===Models.user.data.id?(plugCubed.log("You can't ignore yourself",f,plugCubed.colors.f),e):-1<plugCubed.settings.K.indexOf(a.id)?(plugCubed.settings.K.splice(plugCubed.settings.K.indexOf(a.id),1),plugCubed.saveSettings(),log("You are no longer ignoring "+a.username),e):(plugCubed.settings.K.push(a.id),plugCubed.saveSettings(),log("You are now ignoring "+a.username),e);if(plugCubed.I(Models.user.data.id)&&0===a.indexOf("/whois "))return plugCubed.Q(a.substr(7)),
e;if(Models.user.hasPermission(Models.user.BOUNCER)){if(0===a.indexOf("/skip")){if(Models.room.data.djs[0].user.id==Models.user.data.id)Room.onSkipClick();else c=a.substr(5).trim(),a=plugCubed.getUser(Models.room.data.currentDJ),c&&API.sendChat((a!=f?"@"+a.username+" - ":"")+"Reason for skip: "+c),new ModerationForceSkipService;return e}if(0===a.indexOf("/whois "))return plugCubed.Q(a.substr(7)),e;if(0===a.indexOf("/kick "))if(0<a.indexOf("::")){c=a.substr(6).split(":: ");b=60;if(2==c.length)return!isNaN(parseInt(c[1],
10))&&isFinite(c[1])&&(b=parseFloat(c[1])),a=plugCubed.getUser(c[0]),new ModerationKickUserService(a.id,!isNaN(parseInt(c[1],10))&&isFinite(c[1])?" ":c[1],b),e;if(3==c.length)return b=parseFloat(c[2]),a=plugCubed.getUser(c[0]),new ModerationKickUserService(a.id,c[1],b),e}else return plugCubed.Y(a.substr(6),"kick"),e;if(0===a.indexOf("/add "))return plugCubed.Y(a.substr(5),"adddj"),e;if(0===a.indexOf("/remove "))return plugCubed.Y(a.substr(8),"removedj"),e}if(Models.user.hasPermission(Models.user.MANAGER)){if("/lock"===
a)return new RoomPropsService(document.location.href.split("/")[3],e,Models.room.data.waitListEnabled,Models.room.data.maxPlays,Models.room.data.maxDJs),e;if("/unlock"===a)return new RoomPropsService(document.location.href.split("/")[3],h,Models.room.data.waitListEnabled,Models.room.data.maxPlays,Models.room.data.maxDJs),e}return h}}));plugCubed.pa=e;
