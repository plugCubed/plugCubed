/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use this software for any purpose without fee is hereby granted, provided
 that the above copyright notice and this permission notice appear in all copies.

 Permission to copy and/or edit this software or parts of it for any purpose is permitted,
 provided that the following points are followed.
 - The above copyright notice and this permission notice appear in all copies
 - Within two (2) days after modification is proven working, any modifications are send back
   to the original authors to be inspected with the goal of inclusion in the official software
 - Any edited version are only test versions and not permitted to be run as a final product
 - Any edited version aren't to be distributed
 - Any edited version have the prerelease version set to something that can be distinguished
   from a version used in the original software

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
"undefined"!==typeof plugCubed&&plugCubed.close();if("undefined"===typeof k)var k={};Math.La=function(){return 1+Math.floor(10*Math.random())};var plugCubed,n=!1;console.info=function(f){var g;console.log(f);n||(n=!0,g=$("#chat-messages"),f=g.scrollTop()>g[0].scrollHeight-g.height()-20,g.append('<div class="chat-update"><span class="chat-text" style="color:#FF0000">'+plugCubed.d("disconnected",[plugCubed.ka()])+"</span></div>"),f&&g.scrollTop(g[0].scrollHeight))};
define("plugCubed/Model",["app/base/Class","app/facades/ChatFacade","app/store/LocalStorage","app/utils/Utilities","app/models/RoomModel"],function(f,g,c,e,l){return f.extend({J:{},version:{major:2,minor:0,patch:8,aa:"",oa:!0,toString:function(){return this.major+"."+this.minor+"."+this.patch+(void 0!==this.aa&&""!==this.aa?"-"+this.aa:"")+(this.oa?"_min":"")}},init:function(){null!==c.getItem("plugCubedLang")&&"@@@"!==c.getItem("plugCubedLang")&&(this.proxy={na:$.proxy(this.Ia,this),S:$.proxy(this.S,
this),T:$.proxy(this.T,this),R:$.proxy(this.R,this),onUserJoin:$.proxy(this.onUserJoin,this),onUserLeave:$.proxy(this.onUserLeave,this),Q:$.proxy(this.Q,this),q:$.proxy(this.q,this),onSkip:$.proxy(this.onSkip,this),onRoomJoin:$.proxy(this.onRoomJoin,this)},$.getScript("http://plugCubed.com/compiled/langs/lang."+c.getItem("plugCubedLang")+".js",function(){require(["plugCubed/Lang"],function(a){plugCubed.lang=a;plugCubed.xa()})}),"undefined"===typeof jQuery.fn.Ma&&($.getScript("http://code.jquery.com/ui/1.10.2/jquery-ui.js"),
$("head").append('<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />')))},d:function(a,b){var d=this.lang,h;if(void 0===d)return"{"+a+"}";a=a.split(".");for(h in a){if(void 0===d[a[h]])return"{"+a.join(".")+"}";d=d[a[h]]}if(b)for(h in b)d=d.split("%"+(~~h+1)).join(b[h]);return d},xa:function(){this.e={W:"66FFFF",N:"FF0000",X:"FFFF00",Pa:"66FFFF"};this.ia=this.d("AFK");setTimeout(function(){plugCubed.history=[];var a=API.getHistory(),b;for(b in a){var d=
a[b];plugCubed.history.push({id:d.media.id,author:d.media.author,title:d.media.title,ca:!1,user:{id:d.user.id.toString(),username:d.user.username}})}},1);this.I=$('<style type="text/css" />');$("head").append(this.I);var a=$("#chat-messages"),b=a.scrollTop()>a[0].scrollHeight-a.height()-20;a.append('<div class="chat-update"><span class="chat-text" style="color:#FFFF00">'+this.d("running",[this.version.toString()])+'</span><br /><span class="chat-text" style="color:#66FFFF">'+this.d("commandsHelp")+
"</span></div>");b&&a.scrollTop(a[0].scrollHeight);window.history&&history.pushState&&(function(a){if(void 0===this.history.Ja){var b=new CustomEvent("pushState"),d=a.pushState;this.history.Ja=!0;a.pushState=function(c){window.dispatchEvent(b);return d.apply(a,arguments)}}}(window.history),window.addEventListener("pushState",this.proxy.onRoomJoin));this.Ea();$("body").prepend('<link rel="stylesheet" type="text/css" id="plugcubed-css" href="http://plugCubed.com/compiled/plugCubed.css" />').prepend('<link rel="stylesheet" type="text/css" id="font-awesome" href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css">');
$("body").append($('<div id="side-left" class="sidebar" />').append($('<div class="sidebar-content" />'))).append($('<div id="side-right" class="sidebar" />').append($('<div class="sidebar-handle"><span>||</span></div>')).append($('<div class="sidebar-content" />'))).append('<script type="text/javascript" src="http://plugCubed.com/compiled/thirdparty.js">\x3c/script>');this.Ca();this.Ba();this.settings.A?(this.U(),this.ba()):this.la();var a=API.getUsers(),d;for(d in a)void 0===k[a[d].id]&&(k[a[d].id]=
{G:0,M:0,H:0,joinTime:Date.now()});this.da();this.loaded=!0},onRoomJoin:function(){"undefined"!==typeof plugCubed&&setTimeout(function(){if(API.enabled)plugCubed.close(),plugCubed=new plugCubedModel;else plugCubed.onRoomJoin()},500)},close:function(){if(void 0!==this.loaded&&!1!==this.loaded){API.off(API.CHAT_COMMAND,this.ha);API.off(API.DJ_ADVANCE,this.proxy.S);API.off(API.VOTE_UPDATE,this.proxy.T);API.off(API.CURATE_UPDATE,this.proxy.R);API.off(API.USER_JOIN,this.proxy.onUserJoin);API.off(API.USER_LEAVE,
this.proxy.onUserLeave);API.off(API.CHAT,this.proxy.Q);API.off(API.VOTE_SKIP,this.proxy.onSkip);API.off(API.USER_SKIP,this.proxy.onSkip);API.off(API.MOD_SKIP,this.proxy.onSkip);API.off(API.WAIT_LIST_UPDATE,this.proxy.q);window.removeEventListener("pushState",this.proxy.Ra);for(var a in plugCubed.J)void 0!==a&&void 0!==plugCubed.J[a]&&($("#plugcubed-btn-"+a).unbind(),delete plugCubed.J[a]);$("#plugcubed-css").remove();$("#font-awesome").remove();$("#plugcubed-js-extra").remove();$("#side-right").remove();
$("#side-left").remove();$("#notify-dialog").remove();this.I&&this.I.remove();this.socket&&(this.socket.onclose=function(){},this.socket.close());requirejs.undef("plugCubed/Model");requirejs.undef("plugCubed/dialog/notify");requirejs.undef("plugCubed/dialog/customChatColors");requirejs.undef("plugCubed/dialog/chatLimit");requirejs.undef("plugCubed/dialog/commands");requirejs.undef("plugCubed/Lang");requirejs.undef("plugCubed/Loader");this.loaded=!1;delete plugCubed}},da:function(){this.socket=new SockJS("http://socket.plugpony.net:923/gateway");
this.socket.tries=0;this.socket.onopen=function(){this.tries=0;var a=API.getUser();this.send(JSON.stringify({type:"userdata",id:a.id,username:a.username,room:window.location.pathname.split("/")[1],version:plugCubed.version.toString()}))};this.socket.onmessage=function(a){a=JSON.parse(a.data);"update"===a.type?(plugCubed.socket.onclose=function(){},plugCubed.socket.close(),API.chatLog(plugCubed.d("newVersion"),null,plugCubed.e.X),setTimeout(function(){$.getScript("http://plugcubed.com/compiled/plugCubed."+
(plugCubed.version.oa?"min.":"")+"js")},5E3)):"chat"===a.type&&g.receive(a.data)};this.socket.onclose=function(){this.tries++;var a;if(5>this.tries)a=5;else if(30>this.tries)a=30;else if(60>this.tries)a=60;else return;setTimeout(function(){plugCubed.da()},1E3*a)}},ba:function(){$("#side-left").show().animate({left:"0px"},300,"undefined"===typeof jQuery.easing.Aa?void 0:"easeOutQuart")},la:function(){var a=-$("#side-left").width()-20;$("#side-left").animate({left:a+"px"},300,"undefined"===typeof jQuery.easing.Aa?
void 0:"easeOutQuart",function(){$("#side-left").hide()})},P:{wa:{title:"ranks.you",color:"FFDD6F"},pa:{title:"ranks.regular",color:"B0B0B0"},ja:{title:"ranks.featureddj",color:"E90E82"},bouncer:{title:"ranks.bouncer",color:"E90E82"},manager:{title:"ranks.manager",color:"E90E82"},cohost:{title:"ranks.cohost",color:"E90E82"},host:{title:"ranks.host",color:"E90E82"},ambassador:{title:"ranks.ambassador",color:"9A50FF"},admin:{title:"ranks.admin",color:"42A5DC"},join:{title:"notify.join",color:"3366FF"},
ma:{title:"notify.leave",color:"3366FF"},curate:{title:"notify.curate",color:"00FF00"},qa:{title:"notify.stats",color:"66FFFF"},ta:{title:"notify.updates",color:"FFFF00"}},settings:{V:!1,O:"",C:!1,j:!1,A:!1,k:!1,na:!1,notify:0,F:!1,emoji:!0,Na:!0,u:[],ignore:[],ea:[],B:!1,n:{enabled:!1,limit:50},e:{wa:"FFDD6F",pa:"B0B0B0",ja:"E90E82",bouncer:"E90E82",manager:"E90E82",cohost:"E90E82",host:"E90E82",ambassador:"9A50FF",admin:"42A5DC",join:"3366FF",ma:"3366FF",curate:"00FF00",qa:"66FFFF",ta:"FFFF00"}},
Ea:function(){try{var a=JSON.parse(c.getItem("plugCubed")),b;for(b in this.settings)void 0!==a[b]&&(this.settings[b]=a[b]);this.settings.V=!1;this.settings.C&&this.va();this.settings.A&&(this.U(),this.ba());this.settings.F&&this.ra();0<this.settings.u.length&&-1<this.settings.u.indexOf(Models.room.data.media.id)&&(API.setVolume(0),this.settings.B=!0,API.chatLog(this.d("automuted",[Models.room.data.media.title])));if(void 0===JSON.parse(c.getItem("stngs")).emoji){var d=JSON.parse(c.getItem("stngs"));
d.emoji=!0;c.setItem("stngs",JSON.stringify(d),!0)}}catch(h){}},saveSettings:function(){c.setItem("plugCubed",JSON.stringify(this.settings))},ra:function(){this.settings.F?this.I.text([".chat-message .chat-from,",".chat-mention .chat-from { color:#"+this.settings.e.pa+"!important; }",".chat-message .chat-from-featureddj,",".chat-mention .chat-from-featureddj { color:#"+this.settings.e.ja+"!important; }",".chat-message .chat-from-bouncer,",".chat-mention .chat-from-bouncer { color:#"+this.settings.e.bouncer+
"!important; }",".chat-message .chat-from-manager,",".chat-mention .chat-from-manager { color:#"+this.settings.e.manager+"!important; }",".chat-message .chat-from-cohost,",".chat-mention .chat-from-cohost { color:#"+this.settings.e.cohost+"!important; }",".chat-message .chat-from-host,",".chat-mention .chat-from-host { color:#"+this.settings.e.host+"!important; }",".chat-message .chat-from-ambassador,",".chat-mention .chat-from-ambassador { color:#"+this.settings.e.ambassador+"!important; }",".chat-message .chat-from-admin,",
".chat-mention .chat-from-admin { color:#"+this.settings.e.admin+"!important; }",".chat-message .chat-from-you,",".chat-mention .chat-from-you { color:#"+this.settings.e.wa+"!important; }"].join("\n")):this.I.text("")},Ba:function(){API.on(API.CHAT_COMMAND,this.ha);API.on(API.DJ_ADVANCE,this.proxy.S);API.on(API.VOTE_UPDATE,this.proxy.T);API.on(API.CURATE_UPDATE,this.proxy.R);API.on(API.USER_JOIN,this.proxy.onUserJoin);API.on(API.USER_LEAVE,this.proxy.onUserLeave);API.on(API.CHAT,this.proxy.Q);API.on(API.VOTE_SKIP,
this.proxy.onSkip);API.on(API.USER_SKIP,this.proxy.onSkip);API.on(API.MOD_SKIP,this.proxy.onSkip);API.on(API.WAIT_LIST_UPDATE,this.proxy.q)},Ca:function(){$("#side-right .sidebar-content").html("");this.p(this.settings.C,"woot",this.d("menu.autowoot"));this.p(this.settings.j,"join",this.d("menu.autojoin"));this.p(this.settings.A,"userlist",this.d("menu.userlist"));this.p(this.settings.F,"colors",this.d("menu.customchatcolors"));this.p(this.settings.k,"autorespond",this.d("menu.afkstatus"));this.p(1===
(this.settings.notify&1),"notify",this.d("menu.notify"));this.p(this.settings.n.enabled,"chatlimit",this.d("menu.limitchatlog"));this.p(!JSON.parse(c.getItem("stngs")).streamDisabled,"stream",this.d("menu.stream"));this.p(JSON.parse(c.getItem("stngs")).emoji,"emoji",this.d("menu.emoji"))},p:function(a,b,d){void 0===this.J[b]&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+b+
'"><div class="status-'+(a?"on":"off")+'"></div>'+d+"</a>"),$("#plugcubed-btn-"+b).data("key",b).click(this.proxy.na),this.J[b]={text:d})},f:function(a,b){$("#plugcubed-btn-"+a).find('[class^="status-"], [class*=" status-"]').attr("class","status-"+(!0===b?"on":"off"))},U:function(){0<$("#side-left .sidebar-content").children().length&&$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").bind("contextmenu",function(){return!1});$("#side-left .sidebar-content").html('<h1 class="users">Users: '+
API.getUsers().length+"</h1>");var a=API.getWaitListPosition(),a=$("<h3></h3>").addClass("waitlistspot").text("Waitlist: "+(-1!=a?a+" / ":"")+API.getWaitList().length);$("#side-left .sidebar-content").append(a).append("<hr />");a=API.getUsers();a.sort();a.sort(function(a,b){function c(a){return plugCubed.D(a.id)?20:plugCubed.Y(a.id)?19:API.hasPermission(a.id,API.ROLE.ADMIN)?API.ROLE.ADMIN:API.hasPermission(a.id,API.ROLE.AMBASSADOR)?API.ROLE.AMBASSADOR:API.hasPermission(a.id,API.ROLE.HOST)?API.ROLE.HOST:
API.hasPermission(a.id,API.ROLE.COHOST)?API.ROLE.COHOST:API.hasPermission(a.id,API.ROLE.MANAGER)?API.ROLE.MANAGER:API.hasPermission(a.id,API.ROLE.BOUNCER)?API.ROLE.BOUNCER:API.hasPermission(a.id,API.ROLE.FEATUREDDJ)?API.ROLE.FEATUREDDJ:API.ROLE.NONE}var e=c(a),l=c(b);return e<l?1:e>l?-1:0});for(var b in a)this.ya(a[b])},ya:function(a){var b,d=e.cleanTypedString(a.username);b=!0==a.curated?"curate":this.D(a.id)?"plugcubed":this.Y(a.id)?"vip":API.hasPermission(a.id,API.ROLE.ADMIN)?"admin":API.hasPermission(a.id,
API.ROLE.AMBASSADOR)?"ambassador":API.hasPermission(a.id,API.ROLE.HOST)?"host":API.hasPermission(a.id,API.ROLE.COHOST)?"host":API.hasPermission(a.id,API.ROLE.MANAGER)?"manager":API.hasPermission(a.id,API.ROLE.BOUNCER)?"bouncer":API.hasPermission(a.id,API.ROLE.FEATUREDDJ)?"fdj":"normal";0<API.getDJs().length&&API.getDJs()[0].id==a.id?this.fa("normal"===b?"void":b+"_current","#66FFFF",a.username):this.fa("normal"===b?"void":b+this.Ka(a.vote),this.za(a.vote),d)},za:function(a){var b="";if(void 0===a)b=
"FFFFFF";else switch(a){case -1:b="ED1C24";break;case 1:b="3FFF00";break;default:b="FFFFFF"}return"#"+b},Ka:function(a){var b="";if(void 0===a)b="undecided";else switch(a){case -1:b="meh";break;case 1:b="woot";break;default:b="undecided"}return"_"+b},fa:function(a,b,d){$("#side-left .sidebar-content").append($("<p></p>").append($("<span></span>").append($("<span></span>").addClass(a)).css("cursor","pointer").css("color",b).mousedown(function(a){switch(a.which){case 1:$("#chat-input-field").val($("#chat-input-field").val()+
"@"+d+" ").focus();break;case 3:(API.hasPermission(void 0,API.ROLE.BOUNCER)||plugCubed.D(API.getUser().id))&&plugCubed.getUserInfo(d)}}).html(function(a,b){return b+d})))},getUser:function(a){a=a.trim();"@"===a.substr(0,1)&&(a=a.substr(1));var b=API.getUsers(),d;for(d in b)if(("string"!==typeof a?0:b[d].username.toLowerCase()===a.toLowerCase())||("string"!==typeof a?0:b[d].id.toLowerCase()===a.toLowerCase()))return b[d];return null},Z:function(a,b){if(API.hasPermission(void 0,API.ROLE.BOUNCER)){var d;
switch(b){case "kick":d=API.moderateKickUser;break;case "removedj":d=API.moderateRemoveDJ;break;case "adddj":d=API.moderateAddDJ;break;default:API.chatLog(this.d("error.unknownModeration"));return}var h=this.getUser(a);null===h?API.chatLog(this.d("error.userNotFound")):d(h.id," ")}},getUserInfo:function(a){a=this.getUser(a);if(null===a)API.chatLog(this.d("error.userNotFound"));else{var b=k[a.id],d,h,c,e,l=a.djPoints+a.curatorPoints+a.listenerPoints,g=b.G+b.M;c=API.getWaitListPosition();var f=-1;h=
API.getDJs();d=API.hasPermission(a.id,API.ROLE.ADMIN)?this.d("ranks.admin"):API.hasPermission(a.id,API.ROLE.AMBASSADOR)?this.d("ranks.ambassador"):API.hasPermission(a.id,API.ROLE.HOST)?this.d("ranks.host"):API.hasPermission(a.id,API.ROLE.COHOST)?this.d("ranks.cohost"):API.hasPermission(a.id,API.ROLE.MANAGER)?this.d("ranks.manager"):API.hasPermission(a.id,API.ROLE.BOUNCER)?this.d("ranks.bouncer"):API.hasPermission(a.id,API.ROLE.FEATUREDDJ)?this.d("ranks.featureddj"):this.d("ranks.regular");if(-1===
c)if(0<h.length&&h[0].id===a.id)e=this.d("info.djing"),f=0;else{for(c=1;c<h.length;c++)f=h.id===a.id?c:f;e=0>f?this.d("info.notinlist"):this.d("info.inbooth",[f+1,h.length])}else e=this.d("info.inwaitlist",[c,API.getWaitList().length]);switch(a.status){default:h=this.d("status.available");break;case API.STATUS.AFK:h=this.d("status.afk");break;case API.STATUS.WORKING:h=this.d("status.working");break;case API.STATUS.SLEEPING:h=this.d("status.sleeping")}switch(a.vote){case -1:c=this.d("vote.meh");break;
default:c=this.d("vote.undecided");break;case 1:c=this.d("vote.woot")}0===f&&(c=this.d("vote.djing"));f=void 0;this.D(a.id)&&(f=this.d("info.specialTitles.developer"));this.Y(a.id)&&(f=this.d("info.specialTitles.vip"));var m=$("#chat-messages"),p=m.scrollTop()>m[0].scrollHeight-m.height()-20;m.append('<div class="chat-update"><table style="width:100%;color:#CC00CC"><tr><td colspan="2"><strong>'+this.d("info.name")+'</strong>: <span style="color:#FFFFFF">'+a.username+"</span></td></tr>"+(f?'<tr><td colspan="2"><strong>'+
this.d("info.title")+'</strong>: <span style="color:#FFFFFF">'+f+"</span></td></tr>":"")+'<tr><td colspan="2"><strong>'+this.d("info.id")+'</strong>: <span style="color:#FFFFFF">'+a.id+"</span></td></tr><tr><td><strong> "+this.d("info.rank")+'</strong>: <span style="color:#FFFFFF">'+d+"</span></td><td><strong>"+this.d("info.joined")+'</strong>: <span style="color:#FFFFFF">'+this.ka(b.joinTime)+"</span></td></tr><tr><td><strong>"+this.d("info.status")+'</strong>: <span style="color:#FFFFFF">'+h+"</span></td><td><strong> "+
this.d("info.vote")+'</strong>: <span style="color:#FFFFFF">'+c+'</span></td></tr><tr><td colspan="2"><strong>'+this.d("info.position")+'</strong>: <span style="color:#FFFFFF">'+e+"</span></td></tr><tr><td><strong>"+this.d("info.points")+'</strong>: <span style="color:#FFFFFF" title = "'+this.d("info.pointType.dj",[a.djPoints])+"  +  "+this.d("info.pointType.listener",[a.listenerPoints])+"  +  "+this.d("info.pointType.curator",[a.curatorPoints])+'">'+l+"</span></td><td><strong> "+this.d("info.fans")+
'</strong>: <span style="color:#FFFFFF">'+a.fans+"</span></td></tr><tr><td><strong>"+this.d("info.wootCount")+'</strong>: <span style="color:#FFFFFF">'+b.G+"</span></td><td><strong>"+this.d("info.mehCount")+'</strong>: <span style="color:#FFFFFF">'+b.M+'</span></td></tr><tr><td colspan="2"><strong>'+this.d("info.ratio")+'</strong>: <span style="color:#FFFFFF">'+(0===g?"0":(b.G/g).toFixed(2))+"</span></td></tr></table></div>");p&&m.scrollTop(m[0].scrollHeight)}},Ia:function(a){a=$(a.currentTarget).data("key");
switch(a){case "woot":this.settings.C=!this.settings.C;this.f("woot",this.settings.C);this.settings.C&&$("#button-vote-positive").click();break;case "join":this.settings.j=!this.settings.j;this.f("join",this.settings.j);this.settings.j&&0<$("#button-dj-waitlist-join").length&&API.djJoin();break;case "userlist":this.settings.A=!this.settings.A;this.f("userlist",this.settings.A);this.settings.A?(this.U(),this.ba()):($("#side-left .sidebar-content").empty(),this.la());break;case "colors":require(["plugCubed/dialog/customChatColors",
"app/base/Context","app/events/ShowDialogEvent"],function(a,d,c){d.dispatch(new c(c.SHOW,new a))});break;case "autorespond":this.settings.k=!this.settings.k;this.f("autorespond",this.settings.k);if(this.settings.k){a=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.O?this.ia:this.settings.O);if(null===a){this.settings.k=!1;this.f("autorespond",!1);return}a=a.split("@").join("").trim();this.settings.O=""===a?this.ia:a;0>=API.getUser().status&&
API.setStatus(API.STATUS.AFK)}else API.setStatus(API.STATUS.AVAILABLE);break;case "notify":require(["plugCubed/dialog/notify","app/base/Context","app/events/ShowDialogEvent"],function(a,d,c){d.dispatch(new c(c.SHOW,new a))});break;case "chatlimit":require(["plugCubed/dialog/chatLimit","app/base/Context","app/events/ShowDialogEvent"],function(a,d,c){d.dispatch(new c(c.SHOW,new a))});break;case "stream":return a=JSON.parse(c.getItem("stngs")).streamDisabled,this.f("stream",a),API.sendChat(a?"/stream on":
"/stream off");case "emoji":return a=!1===JSON.parse(c.getItem("stngs")).emoji,this.f("emoji",a),API.sendChat(a?"/emoji on":"/emoji off");default:return API.chatLog(this.d("menu.unknown"))}this.saveSettings()},Qa:function(){for(var a in this.settings.e){var b=$('input[name="'+a+'"]');b.val(b.data("ph"));b.parents(".dialog-input-container").find(".dialog-input-label").css("color","#"+b.val())}},T:function(a){if(a&&a.user){var b=k[a.user.id];this.q();1===b.H?b.G--:-1===b.H&&b.M--;1===a.vote?b.G++:-1===
a.vote&&b.M++;b.H=a.vote}},R:function(a){var b=API.getMedia();if(9===(this.settings.notify&9)){var d=$("#chat-messages"),c=d.scrollTop()>d[0].scrollHeight-d.height()-20;d.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.e.curate+'">'+this.d("notify.message.curate",[a.user.username,b.author,b.title])+"</span></div>");c&&d.scrollTop(d[0].scrollHeight)}API.getUser(a.user.id).curated=!0;this.q()},S:function(a){if(17===(this.settings.notify&17)){var b=$("#chat-messages"),
d=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.e.qa+'">'+this.d("notify.message.stats",[a.lastPlay.score.positive,a.lastPlay.score.negative,a.lastPlay.score.curates])+"</span></div>");d&&b.scrollTop(b[0].scrollHeight)}33===(this.settings.notify&33)&&(b=$("#chat-messages"),d=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.e.ta+
'">'+this.d("notify.message.updates",[a.media.title,a.media.author,a.dj.username])+"</span></div>"),d&&b.scrollTop(b[0].scrollHeight));setTimeout($.proxy(this.Fa,this),1E3*Math.La());(API.hasPermission(void 0,API.ROLE.BOUNCER)||this.D(API.getUser().id))&&this.Ga(a.media.id);this.history.unshift({id:a.media.id,author:a.media.author,title:a.media.title,ca:!1,user:{id:a.dj.id,username:a.dj.username}});this.history.splice(50,this.history.length-50);this.settings.B&&0>this.settings.u.indexOf(a.media.id)&&
(setTimeout(function(){API.setVolume(plugCubed.lastVolume)},800),this.settings.B=!1);!this.settings.B&&-1<this.settings.u.indexOf(a.media.id)&&(setTimeout(function(){API.setVolume(0)},800),this.settings.B=!0,this.lastVolume=API.getVolume(),API.chatLog(i18n("automuted",[a.media.title])));this.q();a=API.getUsers();for(var c in a)k[a[c].id].H=0},Fa:function(){this.settings.C&&0>this.settings.u.indexOf(API.getHistory()[0].media.id)&&this.va();this.settings.j&&("block"!==$("#button-dj-play").css("display")&&
"block"!==$("#button-dj-waitlist-join").css("display")||API.djJoin())},va:function(){if(0!==API.getDJs().length){var a=API.getDJs()[0];null!==a&&a!=API.getUser()&&$("#button-vote-positive").click()}},onUserJoin:function(a){if(3===(this.settings.notify&3)){var b=$("#chat-messages"),d=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.e.join+'">'+e.cleanTypedString(a.username+" joined the room")+"</span></div>");d&&
b.scrollTop(b[0].scrollHeight)}void 0===k[a.id]&&(k[a.id]={G:0,M:0,H:0,joinTime:Date.now()});this.q()},onUserLeave:function(a){if(5===(this.settings.notify&5)){var b=$("#chat-messages"),d=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append('<div class="chat-update"><span class="chat-text" style="color:#'+this.settings.e.ma+'">'+e.cleanTypedString(a.username+" left the room")+"</span></div>");d&&b.scrollTop(b[0].scrollHeight)}this.q()},D:function(a){return"50aeb31696fba52c3ca0adb6"==a||"50aeb077877b9217e2fbff00"==
a},Y:function(a){return"5112c273d6e4a94ec0554792"==a||"50b1961c96fba57db2230417"==a},ga:function(a){var b="mention"==a.type&&API.hasPermission(a.fromID,API.ROLE.BOUNCER),d=0>a.message.indexOf("@")&&this.D(a.fromID);if(b||d)-1<a.message.indexOf("!disable")&&(this.settings.j?(this.settings.j=!1,this.f("join",this.settings.j),this.saveSettings(),API.djLeave(),API.sendChat("@"+a.from+" Autojoin disabled")):API.sendChat("@"+a.from+" Autojoin was not enabled")),-1<a.message.indexOf("!afkdisable")&&(this.settings.k?
(this.settings.k=!1,this.f("autorespond",this.settings.k),this.saveSettings(),API.sendChat("@"+a.from+" AFK message disabled")):API.sendChat("@"+a.from+" AFK message was not enabled")),0<a.message.indexOf("!disable")||a.message.indexOf("!afkdisable")},Q:function(a){a.fromID===API.getUser().id&&this.socket.readyState===SockJS.OPEN&&this.socket.send(JSON.stringify({type:"chat",msg:a.message,chatID:a.chatID}));a.fromID&&-1<this.settings.ignore.indexOf(a.fromID)&&(this.ga(a),$(".chat-id-"+a.chatID).remove());
this.ga(a);if("mention"==a.type)this.settings.k&&!this.settings.V&&(this.settings.V=!0,setTimeout(function(){plugCubed.settings.V=!1;plugCubed.saveSettings()},18E4),API.sendChat("@"+a.from+" "+this.settings.O));else for(var b in this.settings.ea)-1<a.message.indexOf(this.settings.ea[b])&&document.getElementById("chat-sound").playMentionSound();if(this.settings.n.enabled){a=$("#chat-messages").children("div");var d=a.length;b=0;a.each(function(){++b;var a=d-plugCubed.settings.n.limit-1;b<a?$(this).remove():
b==a&&0==b%2&&$(this).remove()})}},q:function(){this.settings.A&&this.U()},onSkip:function(){this.history[1].ca=!0},Ga:function(a){var b=-1,d;for(d in this.history){var c=this.history[d];if(c.id==a&&51>~~d+2&&(b=~~d+2,!c.ca))return API.chatLog("Song is in history ("+b+" of "+this.history.length+")",!0)}if(0<b)return API.chatLog("Song is in history ("+b+" of "+this.history.length+"), but was skipped on the last play",!0)},ka:function(a){a=a?new Date(a):new Date;var b=a.getMinutes();return a.getHours()+
":"+((10>b?"0":"")+b)},W:[["/nick","change username"],["/avail","set status to available"],["/afk","set status to afk"],["/work","set status to working"],["/sleep","set status to sleeping"],["/join","join dj booth/waitlist"],["/leave","leaves dj booth/waitlist"],["/whoami","get your own information"],["/mute","set volume to 0"],["/automute","register currently playing song to automatically mute on future plays"],["/unmute","set volume to last volume"],["/woot","woots current song"],["/meh","mehs current song"],
["/refresh","refresh the video"],["/ignore (username)","ignore all chat messages from user"],["/alertson (word)","play mention sound whenever word is written in chat"],["/curate","add current song to your selected playlist"],["/getpos","get current waitlist position"],["/version","displays version number"],["/commands","shows this list"],["/link","paste link to plugCubed website in chat"]],N:[["/whois (username)","gives general information about user",API.ROLE.BOUNCER],["/skip","skip current song",
API.ROLE.BOUNCER],["/kick (username)","kicks targeted user",API.ROLE.BOUNCER],["/lock","locks DJ booth",API.ROLE.MANAGER],["/unlock","unlocks DJ booth",API.ROLE.MANAGER],["/add (username)","adds targeted user to dj booth/waitlist",API.ROLE.BOUNCER],["/remove (username)","removes targeted user from dj booth/waitlist",API.ROLE.BOUNCER]],ha:function(a){if(0===a.indexOf("/commands"))return require(["plugCubed/dialog/commands","app/base/Context","app/events/ShowDialogEvent"],function(a,b,c){b.dispatch(new c(c.SHOW,
new a))}),!0;if("/avail"==a||"/available"==a)return API.setStatus(0),!0;if("/brb"==a||"/away"==a)return API.setStatus(1),plugCubed.settings.j&&(plugCubed.settings.j=!1,plugCubed.f("join",!1),plugCubed.saveSettings()),!0;if("/work"==a||"/working"==a)return API.setStatus(2),!0;if("/sleep"==a||"/sleeping"==a)return API.setStatus(3),plugCubed.settings.j&&(plugCubed.settings.j=!1,plugCubed.f("join",!1),plugCubed.saveSettings()),!0;if("/join"==a)return API.djJoin(),!0;if("/leave"==a)return API.djLeave(),
!0;if("/whoami"==a)return plugCubed.getUserInfo(API.getUser().id),!0;if("/woot"==a)return $("#button-vote-positive").click(),!0;if("/meh"==a)return $("#button-vote-negative").click(),!0;if("/refresh"==a)return $("#button-refresh").click(),!0;if("/version"==a)return API.chatLog(this.d("running",[plugCubed.version.toString()])),!0;if("/mute"==a)return plugCubed.lastVolume=API.getVolume(),API.setVolume(0),!0;if("/link"==a)return API.sendChat("plugCubed : http://plugCubed.com"),!0;if("/unmute"==a)return API.setVolume(plugCubed.lastVolume),
!0;if("/nextsong"==a){var b=API.getNextMedia();void 0===b?API.chatLog(plugCubed.d("noNextSong")):b.inHistory?(API.chatLog(plugCubed.d("nextsong",[b.title,b.author])),API.chatLog(plugCubed.d("isHistory",[found,plugCubed.history.length]),!0)):API.chatLog(plugCubed.d("nextsong",[b.title,b.author]))}if("/automute"==a){b=API.getMedia();if(void 0===b)return!0;0>plugCubed.settings.u.indexOf(b.id)?(plugCubed.settings.u.push(b.id),plugCubed.settings.B=!0,plugCubed.lastVolume=API.getVolume(),API.setVolume(0),
API.chatLog(b.title+" registered to auto-mute on future plays.")):(plugCubed.settings.u.splice(plugCubed.settings.u.indexOf(API.getMedia().id),1),plugCubed.settings.B=!1,API.setVolume(plugCubed.lastVolume),API.chatLog(b.title+" removed from automute registry."));plugCubed.saveSettings();return!0}if("/alertsoff"==a)return 1===(plugCubed.settings.notify&1)&&(b=$("#chat-messages"),a=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+
plugCubed.e.X+'">'+plugCubed.d("notify.message.disabled")+"</span></div>"),a&&b.scrollTop(b[0].scrollHeight),plugCubed.settings.notify--,plugCubed.f("notify",!1)),!0;if("/alertson"==a)return 1!==(plugCubed.settings.notify&1)&&(b=$("#chat-messages"),a=b.scrollTop()>b[0].scrollHeight-b.height()-20,b.append('<div class="chat-update"><span class="chat-text" style="color:#'+plugCubed.e.X+'">'+plugCubed.d("notify.message.enabled")+"</span></div>"),a&&b.scrollTop(b[0].scrollHeight),plugCubed.settings.notify++,
plugCubed.f("notify",!0)),!0;if(0===a.indexOf("/getpos"))return b=plugCubed.getUser(a.substr(8)),b=null===b?API.getUser():b,a=API.getWaitListPosition(b.id),-1!=a?API.chatLog(plugCubed.d("info.inwaitlist",[a,API.getWaitList.length])):(a=API.getBoothPosition(b.id),0>a?API.chatLog(plugCubed.d("info.notinlist")):0===a?API.chatLog(plugCubed.d("info.userDjing",[b.id===API.getUser().id?plugCubed.d("you"):b.username])):1===a?API.chatLog(plugCubed.d("info.userNextDJ",[b.id===API.getUser().id?plugCubed.d("you"):
b.username])):API.chatLog(plugCubed.d("info.inbooth",[a+1,API.getDJs().length]))),!0;if(0===a.indexOf("/ignore ")||0===a.indexOf("/unignore "))return b=plugCubed.getUser(a.substr(8)),null===b?(API.chatLog(plugCubed.d("error.userNotFound")),!0):b.id===API.getUser().id?(API.chatLog(plugCubed.d("error.ignoreSelf")),!0):-1<plugCubed.settings.ignore.indexOf(b.id)?(plugCubed.settings.ignore.splice(plugCubed.settings.ignore.indexOf(b.id),1),plugCubed.saveSettings(),API.chatLog(plugCubed.d("ignore.disabled",
[b.username])),!0):(plugCubed.settings.ignore.push(b.id),plugCubed.saveSettings(),API.chatLog(plugCubed.d("ignore.enabled",[b.username])),!0);if(plugCubed.D(API.Oa)&&0===a.indexOf("/whois "))return plugCubed.getUserInfo(a.substr(7)),!0;if(API.hasPermission(void 0,API.ROLE.BOUNCER)){if(0===a.indexOf("/skip")){if(1>API.getDJs().length)return;0===API.getBoothPosition()?$("#button-skip-this").click():(5<a.length&&API.sendChat("@"+API.getDJs()[0].username+" - Reason for skip: "+a.substr(5).trim()),API.moderateForceSkip());
return!0}if(0===a.indexOf("/whois "))return plugCubed.getUserInfo(a.substr(7)),!0;if(0===a.indexOf("/kick "))return 0<a.indexOf("::")?(a=a.substr(6).split(":: "),b=plugCubed.getUser(a[0]),API.moderateKickUser(b.id,a[1]),!0):(plugCubed.Z(a.substr(6),"kick"),!0);if(0===a.indexOf("/add "))return plugCubed.Z(a.substr(5),"adddj"),!0;if(0===a.indexOf("/remove "))return plugCubed.Z(a.substr(8),"removedj"),!0}if(API.hasPermission(void 0,API.ROLE.MANAGER)){if("/lock"===a)return API.moderateRoomProps(!0,l.get("waitListEnabled")),
!0;if("/unlock"===a)return API.moderateRoomProps(!1,l.get("waitListEnabled")),!0}return!1}})});
define("plugCubed/dialog/notify",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(f,g){return f.extend({id:"dialog-notify",className:"dialog",render:function(){return this.$el.append(this.getHeader(plugCubed.d("notify.header"))).append(this.getBody().append('<table style="width: 100%;"><tr><td>'+plugCubed.d("enable")+'</td><td align="right"><input type="checkbox" name="enabled"'+(1===(plugCubed.settings.notify&1)?' checked="checked"':"")+' value="1" /></td></tr><tr><td>'+plugCubed.d("notify.join")+
'</td><td align="right"><input type="checkbox" name="join"'+(2===(plugCubed.settings.notify&2)?' checked="checked"':"")+' value="2" /></td></tr><tr><td>'+plugCubed.d("notify.leave")+'</td><td align="right"><input type="checkbox" name="leave"'+(4===(plugCubed.settings.notify&4)?' checked="checked"':"")+' value="4" /></td></tr><tr><td>'+plugCubed.d("notify.curate")+'</td><td align="right"><input type="checkbox" name="curate"'+(8===(plugCubed.settings.notify&8)?' checked="checked"':"")+' value="8" /></td></tr><tr><td>'+
plugCubed.d("notify.stats")+'</td><td align="right"><input type="checkbox" name="songStats"'+(16===(plugCubed.settings.notify&16)?' checked="checked"':"")+' value="16" /></td></tr><tr><td>'+plugCubed.d("notify.updates")+'</td><td align="right"><input type="checkbox" name="songUpdate"'+(32===(plugCubed.settings.notify&32)?' checked="checked"':"")+' value="32" /></td></tr></table>')).append(this.getSubmitButton(g.dialog.ok)),this._super()},submit:function(){plugCubed.settings.notify=0;this.$el.find(":checked").each(function(){plugCubed.settings.notify+=
~~$(this).val()});plugCubed.saveSettings();plugCubed.f("notify",1===(plugCubed.settings.notify&1));this.close()}})});
define("plugCubed/dialog/customChatColors",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(f,g){return f.extend({id:"dialog-custom-colors",className:"dialog",render:function(){var c=$('<table style="width:100%;padding:5px"/>');c.append("<tr><td>"+plugCubed.d("enable")+'</td><td align="right"><input type="checkbox" name="enabled"'+(plugCubed.settings.F?' checked="checked"':"")+" /></td></tr>");for(var e in plugCubed.P)c.append($("<tr/>").append('<td style="color:#'+plugCubed.settings.e[e]+
'"><span>'+plugCubed.d(plugCubed.P[e].title)+"<span></td>").append($('<td align="right"></td>').append($('<input type="text" name="'+e+'" value="'+plugCubed.settings.e[e]+'" placeholder="'+plugCubed.P[e].color+'" />').data("default",plugCubed.P[e].color).css("width","60px").change(function(){$(this).closest("tr").find("span").css("color","#"+$(this).val())}))));return this.$el.append(this.getHeader(plugCubed.d("chatLimit.header"))).append(this.getBody().append(c)).append($("<div/>").addClass("dialog-button dialog-default-button").click(function(){$(this).parent().find('input[type="text"]').each(function(){var c=
$(this);c.val(c.data("default"));c.closest("tr").find("span").css("color","#"+c.val())})}).append($("<span/>").text("Default"))).append(this.getCancelButton()).append(this.getSubmitButton(g.dialog.ok)),this._super()},submit:function(){plugCubed.settings.F=this.$el.find('input[name="enabled"]').is(":checked");for(var c in plugCubed.settings.e){var e=this.$el.find('input[name="'+c+'"]'),f=plugCubed.settings.e,a=c,b;if(b=""!==e.val())b=e.val(),b=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test("#"===b.substr(0,
1)?b:"#"+b);f[a]=b?e.val():e.data("default")}plugCubed.f("colors",plugCubed.settings.F);plugCubed.saveSettings();plugCubed.ra();this.close()}})});
define("plugCubed/dialog/chatLimit",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(f,g){return f.extend({id:"dialog-chat-limit",className:"dialog",render:function(){return this.$el.append(this.getHeader(plugCubed.d("chatLimit.header"))).append(this.getBody().append('<table style="width: 100%;"><tr><td>'+plugCubed.d("enable")+'</td><td align="right"><input type="checkbox" name="enabled"'+(plugCubed.settings.n.enabled?' checked="checked"':"")+" /></td></tr><tr><td>"+plugCubed.d("chatLimit.limit")+
'</td><td align="right"><input type="text" name="limit" value="'+plugCubed.settings.n.limit+'" /></td></tr></table>')).append(this.getSubmitButton(g.dialog.ok)),this._super()},submit:function(){plugCubed.settings.n.enabled=this.$el.find('input[name="enabled"]').is(":checked");plugCubed.settings.n.limit=~~this.$el.find('input[name="limit"]').val();plugCubed.f("chatlimit",plugCubed.settings.n.enabled);plugCubed.saveSettings();if(plugCubed.settings.n.enabled){var c=$("#chat-messages").children("div"),
e=c.length,f=0;c.each(function(){++f<e-plugCubed.settings.n.limit&&$(this).remove()})}this.close()}})});
define("plugCubed/dialog/commands",["app/views/dialogs/AbstractDialogView","lang/Lang"],function(f,g){return f.extend({id:"dialog-commands",className:"dialog",render:function(){var c="<table>",e;for(e in plugCubed.W)c+="<tr><td>"+plugCubed.W[e][0]+"</td><td>"+plugCubed.W[e][1]+"</td></tr>";c+="</table>";if(API.hasPermission(void 0,API.ROLE.BOUNCER)){c='<div id="plugCubedCommands"><ul><li><a href="#user">'+plugCubed.d("commands.userCommands")+'</a></li><li><a href="#mod">'+plugCubed.d("commands.modCommands")+
'</a></li></ul><div id="user">'+c+'</div><div id="mod"><table>';for(e in plugCubed.N)API.hasPermission(void 0,plugCubed.N[e][2])&&(c+="<tr><td>"+plugCubed.N[e][0]+"</td><td>"+plugCubed.N[e][1]+"</td></tr>");c=$(c+"</table></div></div>").Ma()}return this.$el.append(this.getHeader(plugCubed.d("commands.header"))).append(this.getBody().append(c)).append(this.getSubmitButton(g.dialog.ok)),this._super()},submit:function(){this.close()}})});
define("plugCubed/Loader",["app/base/Class","plugCubed/Model","app/store/LocalStorage"],function(f,g,c){var e=c.getItem("plugCubedLang");return null!==e&&"@@@"!==e?f.extend({init:function(){plugCubed=new g}}):f.extend({init:function(){$("#overlay-container").append($("#avatar-overlay").clone(!1,!1).attr("id","plugCubedLang-overlay").width(800).height(600).css("position","absolute"));$("#plugCubedLang-overlay").find(".overlay-title").html("plug&#179; language");$("#plugCubedLang-overlay").find("#avatar-sets").remove();
$("#plugCubedLang-overlay").find("#avatar-panel").attr("id","plugCubedLang-panel").css("padding-top","60px");$("#plugCubedLang-overlay").find(".overlay-close-button").click($.proxy(this.hide,this));this.Da()},show:function(){$("#user-list-overlay").hide();$("#lobby-overlay").hide();$("#media-overlay").hide();$("#avatar-overlay").hide();$("#plugCubedLang-overlay").show();$("#overlay-container").show();this.draw()},hide:function(){$("#user-list-overlay").hide();$("#lobby-overlay").hide();$("#media-overlay").hide();
$("#avatar-overlay").hide();$("#plugCubedLang-overlay").hide();$("#overlay-container").hide()},draw:function(){$("#plugCubedLang-panel").html("").scrollTop(0);var c=this.L.length,a=$("<div/>");if(5<c)for(var b=0;b<c/5;b++)a.append(this.drawRow(this.L.slice(5*b,5*b+5)).css("top",75*b));else a.append(this.drawRow(this.L).css("top",75*b));$("#plugCubedLang-panel").append(a);$(".lang-button").click($.proxy(this.Ha,this))},drawRow:function(c){for(var a=$("<div/>").addClass("lang-row"),b=c.length,d=5==
b?0:4==b?75:3==b?150:2==b?225:300,e=0;e<b;++e){var f=$("<div/>").addClass("lang-button").css("display","inline-block").css("left",d).data("language",c[e].file).css("cursor","pointer").append($("<img/>").attr("src","http://plugCubed.com/compiled/flags/flag."+c[e].file+".png").attr("alt",c[e].name).height(75).width(150));a.append(f);d+=150}return a},Ha:function(e){e=$(e.currentTarget);c.setItem("plugCubedLang",e.data("language"),!0);plugCubed=new g;this.hide()},Da:function(){var c=this;this.L=[];$.getJSON("http://rawgithub.com/TATDK/plugCubed/gh-pages/compiled/lang.txt",
function(a){c.L=a;c.show()}).done(function(){0===c.L.length&&log('<span style="color:#FF0000">Error loading plugCubed</span>')})}})});require(["plugCubed/Loader"],function(f){new f});
//# sourceMappingURL=http://plugCubed.com/compiled/plugCubed.min.js.map 
