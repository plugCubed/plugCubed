/*
 Copyright (C) 2012-2013 Thomas "TAT" Andresen and other contributors

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
var plugCubed,plugCubedUserData;String.prototype.equalsIgnoreCase=function(b){return"string"!==typeof b?!1:this.toLowerCase()===b.toLowerCase()};String.prototype.startsWith=function(b){return"string"!==typeof b||b.length>this.length?!1:0===this.indexOf(b)};String.prototype.endsWith=function(b){return"string"!==typeof b||b.length>this.length?!1:this.indexOf(b)===this.length-b.length};String.prototype.startsWithIgnoreCase=function(b){return"string"!==typeof b||b.length>this.length?!1:this.toLowerCase().startsWith(b.toLowerCase())};
String.prototype.endsWithIgnoreCase=function(b){return"string"!==typeof b||b.length>this.length?!1:this.toLowerCase().endsWith(b.toLowerCase())};String.prototype.isNumber=function(){return!isNaN(parseInt(this,10))&&isFinite(this)};String.prototype.isRGB=function(){return/^(#|)(([0-9A-F]{6}$)|([0-9A-F]{3}$))/i.test("#"===this.substr(0,1)?this:"#"+this)};String.prototype.toRGB=function(){return this.isRGB()?"#"===this.substr(0,1)?this:"#"+this:void 0};
Math.randomRange=function(b,p){return b+Math.floor(Math.random()*(p-b+1))};void 0!==plugCubed&&plugCubed.close();
(function(){if(!requirejs.defined("e388d/de6ec/ed34d"))return API.chatLog("This version of plug&#179; is not compatible with this version of plug.dj",!0),!1;define("plugCubed/Model","jquery underscore e388d/de6ec/ed34d e388d/de6ec/aeb58 e388d/d1a7d/b2edd e388d/c5c7d/a1b5f e388d/a8df0/fb863 e388d/f46a4/e2337 e388d/f4646/e9104 e388d/c4147/aa770 e388d/c4147/f15de e388d/f46a4/ec4b7 lang/Lang e388d/c2954/faf6b/d2f6f e388d/f4646/a5646 e388d/f4646/b2a58 plugCubed/StyleManager e388d/c2954/faf6b/c591d/fa943 e388d/c2954/faf6b/c591d/a33a6 plugCubed/RoomUserListRow plugCubed/Lang plugCubed/Utils e388d/c5c7d/a1b40 e388d/f46a4/f3ed8 plugCubed/dialogs/CustomChatColors plugCubed/dialogs/Commands plugCubed/Slider plugCubed/VolumeView".split(" "),function(b,
p,f,d,l,e,h,m,B,k,U,ha,V,D,ia,ja,v,M,W,X,c,n,F,w,G,Y,Z,aa){function r(a,b,c){return void 0===plugCubedUserData[a]||void 0===plugCubedUserData[a][b]?c:plugCubedUserData[a][b]}function z(a,b,c){void 0===plugCubedUserData[a]&&(plugCubedUserData[a]={});plugCubedUserData[a][b]=c}function H(a){if(void 0!==a){I=!0;q={};s={};b("#p3-dj-booth").remove();v.unset("rss-background-color rss-background-image rss-booth rss-fonts rss-imports rss-rules rss-maingui".split(" "));if(void 0!==a.colors){void 0!==a.colors.background&&
"string"===typeof a.colors.background&&a.colors.background.isRGB()&&v.set("rss-background-color","body { background-color: "+a.colors.background.toRGB()+"!important; }");if(void 0!==a.colors.chat){var g={},c;for(c in a.colors.chat)-1<"admin ambassador bouncer cohost residentdj leader host manager volunteer".split(" ").indexOf(c)&&"string"===typeof a.colors.chat[c]&&a.colors.chat[c].isRGB()&&(g[c]="#"===a.colors.chat[c].substr(0,1)?a.colors.chat[c].substr(1):a.colors.chat[c]);q=g}void 0!==a.colors.header&&
"string"===typeof a.colors.header&&a.colors.header.isRGB()&&v.set("rss-header","#header { background-color: "+a.colors.header.toRGB()+"!important; }");void 0!==a.colors.footer&&"string"===typeof a.colors.footer&&a.colors.footer.isRGB()&&v.set("rss-footer","#footer { background-color: "+a.colors.footer.toRGB()+"!important; }")}if(void 0!==a.css){if(void 0!==a.css.font&&b.isArray(a.css.font)){g=[];for(c in a.css.font){var d=a.css.font[c];void 0!==d.name&&void 0!==d.url&&(d.toString=function(){var a=
[];if("string"===typeof this.url)a.push('url("'+this.url+'")');else for(var b in this.url)a.push('url("'+this.url[b]+'") format("'+b+'")');return'@font-face { font-family: "'+this.name+'"; src: '+a.join(",")+"; }"},g.push(d.toString()))}v.set("rss-fonts",g.join("\n"))}if(void 0!==a.css.import&&b.isArray(a.css.import)){g=[];for(c in a.css.import)"string"===typeof a.css.import[c]&&g.push('@import url("'+a.css.import[c]+'")');v.set("rss-imports",g.join("\n"))}if(void 0!==a.css.rule){var e=[];for(c in a.css.rule){var g=
[],m;for(m in a.css.rule[c])g.push(m+":"+a.css.rule[c][m]);e.push(c+" {"+g.join(";")+"}")}v.set("rss-rules",e.join("\n"))}}void 0!==a.images&&(a.images.background&&v.set("rss-background-image",'body { background-image: url("'+a.images.background+'")!important; }'),void 0===b("#playback .background img").data("_o")&&b("#playback .background img").data("_o",b("#playback .background img").attr("src")),b("#playback .background img").attr("src",a.images.playback&&"string"===typeof a.images.playback?a.images.playback:
b("#playback .background img").data("_o")),void 0!==a.images.booth&&"string"===typeof a.images.booth&&b("#dj-booth").append(b('<div id="p3-dj-booth">').css("background-image",'url("'+a.images.booth+'")')),s=a.images.icons?a.images.icons:{});void 0!==a.rules&&(void 0!==a.rules.allowAutowoot&&(e.allowAutowoot="true"===a.rules.allowAutowoot),void 0!==a.rules.allowAutorespond&&(e.allowAutorespond="true"===a.rules.allowAutowoot));plugCubed.updateCustomColors()}}function N(){var a=m.get("description"),
g=plugCubed.settings.useRoomSettings[window.location.pathname.split("/")[1]];if(null!==a&&(g=void 0===g||!0===g?!0:!1,-1<a.indexOf("@p3="))){a=a.substr(a.indexOf("@p3=")+4);-1<a.indexOf(" ")&&a.substr(0,a.indexOf(" "));-1<a.indexOf("\n")&&a.substr(0,a.indexOf("\n"));if(g)return b.getJSON(a+"?_"+Date.now(),function(a){n.chatLog(void 0,c.i18n("roomSpecificSettingsHeader")+'</span><br /><span class="chat-text" style="color:#66FFFF">'+c.i18n("roomSpecificSettingsDesc"),plugCubed.colors.infoMessage2);
H(a)});I=!0}}function J(a){a=a.trim();"@"===a.substr(0,1)&&(a=a.substr(1));var b=API.getUsers(),c;for(c in b)if(b[c].username.equalsIgnoreCase(a)||b[c].id.equalsIgnoreCase(a))return b[c];return null}function K(a){a=J(a);if(null===a)API.chatLog(c.i18n("error.userNotFound"));else{var b,d,e,m,f=a.djPoints+a.curatorPoints+a.listenerPoints;r(a.id,"wootcount",0);r(a.id,"mehcount",0);d=API.getWaitListPosition(a.id);var k=API.getDJ().id===a.id;e=a.language;m=l.uiLanguages.concat(l.chatLanguages);var B=r(a.id,
"disconnects",{count:0});for(b in m)m.value===e&&(e=m[b].label);b=API.hasPermission(a.id,API.ROLE.ADMIN)?c.i18n("ranks.admin"):API.hasPermission(a.id,API.ROLE.AMBASSADOR)?c.i18n("ranks.ambassador"):API.hasPermission(a.id,API.ROLE.HOST)?c.i18n("ranks.host"):API.hasPermission(a.id,API.ROLE.COHOST)?c.i18n("ranks.cohost"):API.hasPermission(a.id,API.ROLE.MANAGER)?c.i18n("ranks.manager"):API.hasPermission(a.id,API.ROLE.BOUNCER)?c.i18n("ranks.bouncer"):API.hasPermission(a.id,API.ROLE.RESIDENTDJ)?c.i18n("ranks.residentdj"):
c.i18n("ranks.regular");m=k?c.i18n("info.djing"):-1<d?c.i18n("info.inWaitlist",d+1,API.getWaitList().length):c.i18n("info.notInList");switch(a.status){default:d=c.i18n("status.available");break;case API.STATUS.AFK:d=c.i18n("status.afk");break;case API.STATUS.WORKING:d=c.i18n("status.working");break;case API.STATUS.GAMING:d=c.i18n("status.gaming")}switch(a.vote){case -1:e=c.i18n("vote.meh");break;default:e=c.i18n("vote.undecided");break;case 1:e=c.i18n("vote.woot")}k&&(e=c.i18n("vote.djing"));k=void 0;
n.isPlugCubedDeveloper(a.id)&&(k=c.i18n("info.specialTitles.developer"));n.isPlugCubedSponsor(a.id)&&(k=c.i18n("info.specialTitles.sponsor"));n.isPlugCubedVIP(a.id)&&(k=c.i18n("info.specialTitles.vip"));n.isPlugCubedDonator(a.id)&&(k=c.i18n("info.specialTitles.donator"));n.chatLog(void 0,'<table style="width:100%;color:#CC00CC"><tr><td colspan="2"><strong>'+c.i18n("info.name")+'</strong>: <span style="color:#FFFFFF">'+h.cleanTypedString(a.username)+"</span></td></tr>"+(k?'<tr><td colspan="2"><strong>'+
c.i18n("info.title")+'</strong>: <span style="color:#FFFFFF">'+k+"</span></td></tr>":"")+'<tr><td colspan="2"><strong>'+c.i18n("info.id")+'</strong>: <span style="color:#FFFFFF">'+a.id+"</span></td></tr><tr><td><strong> "+c.i18n("info.rank")+'</strong>: <span style="color:#FFFFFF">'+b+"</span></td><td><strong>"+c.i18n("info.joined")+'</strong>: <span style="color:#FFFFFF">'+plugCubed.getTimestamp(r(a.id,"joinTime",Date.now()))+"</span></td></tr><tr><td><strong>"+c.i18n("info.status")+'</strong>: <span style="color:#FFFFFF">'+
d+"</span></td><td><strong> "+c.i18n("info.vote")+'</strong>: <span style="color:#FFFFFF">'+e+'</span></td></tr><tr><td colspan="2"><strong>'+c.i18n("info.position")+'</strong>: <span style="color:#FFFFFF">'+m+"</span></td></tr><tr><td><strong>"+c.i18n("info.points")+'</strong>: <span style="color:#FFFFFF" title = "'+c.i18n("info.pointType.dj",a.djPoints)+"&#13; "+c.i18n("info.pointType.listener",a.listenerPoints)+"&#13; "+c.i18n("info.pointType.curator",a.curatorPoints)+'">'+f+"</span></td><td><strong> "+
c.i18n("info.fans")+'</strong>: <span style="color:#FFFFFF">'+a.fans+"</span></td></tr><tr><td><strong>"+c.i18n("info.wootCount")+'</strong>: <span style="color:#FFFFFF">'+r(a.id,"wootcount",0)+"</span></td><td><strong>"+c.i18n("info.mehCount")+'</strong>: <span style="color:#FFFFFF">'+r(a.id,"mehcount",0)+'</span></td></tr><tr><td colspan="2"><strong>'+c.i18n("info.ratio")+'</strong>: <span style="color:#FFFFFF">'+function(a,b){if(0===b)return 0===a?"0:0":"1:0";for(var g=1;g<=b;g++){var c=a/b*g;
if(0===c%1)return c+":"+g}}(r(a.id,"wootcount",0),r(a.id,"mehcount",0))+"</span></td></tr><tr><td><strong>"+c.i18n("info.disconnects")+'</strong>: <span style="color:#FFFFFF">'+B.count+"</td></tr>"+(0<B.count?'<tr><td colspan="2"><strong>'+c.i18n("info.lastDisconnect")+'</strong></td></tr><tr><td colspan="2"><strong>'+c.i18n("info.lastPosition")+'</strong>: <span style="color:#FFFFFF">'+(-1>B.position?"Wasn't in booth nor waitlist":0>B.position?"Was DJing":"Was "+(B.position+1)+" in waitlist")+'</span></td></tr><tr><td colspan="2"><strong>'+
c.i18n("info.lastDisconnect")+'</strong>: <span style="color:#FFFFFF">'+plugCubed.getTimestamp(B.time)+"</span></td></tr>":"")+"</table>")}}function ba(){var a=b('<table style="width:100%;color:#CC00CC"/>'),g=API.getUsers(),c;for(c in g)a.append(b("<tr/>").append(b("<td/>").append(g[c].username)).append(b("<td/>").append(g[c].id)));n.chatLog(void 0,b("<div/>").append(a).html())}function E(){document.getElementById("chat-sound").playMentionSound()}function O(){if("undefined"===typeof x.allowAutowoot||
!1!==x.allowAutowoot){var a=API.getDJ();null!==a&&a.id!==API.getUser().id&&b("#woot").click()}}function ca(){if(plugCubed.settings.afkTimers&&(n.isPlugCubedDeveloper()||API.hasPermission(void 0,API.ROLE.BOUNCER))&&b("#waitlist-button").hasClass("selected"))for(var a=API.getWaitList(),c=b("#waitlist .user"),d=0;d<a.length;d++){var e=Date.now()-r(a[d].id,"lastChat",r(a[d].id,"joinTime",Date.now()));1>b(c[d]).find(".afkTimer").length?b(c[d]).find(".meta").append(b("<div>").addClass("afkTimer").text(plugCubed.getTimestamp(e,
36E5>e?"mm:ss":"hh:mm:ss"))):b(c[d]).find(".afkTimer").text(plugCubed.getTimestamp(e,36E5>e?"mm:ss":"hh:mm:ss"))}}function da(){var a=null===b("#yt-frame").height()||230<b("#yt-frame").height()&&284>b("#yt-frame").height(),c=null===b("#yt-frame").width()||412<b("#yt-frame").width()&&505>b("#yt-frame").width(),d=0===b("#plug-btn-hidevideo").length;a&&c&&d||(API.chatLog("plugCubed does not support hiding video",!0),plugCubed.close())}function ea(){var a=d._events["chat:receive"].concat(API._events(API.CHAT)),
b;for(b in a){var c=a[b].callback;if(-1<c.indexOf("API.djLeave")||-1<c.indexOf("API.djJoin")||-1<c.indexOf("API.moderateLockWaitList")||-1<c.indexOf("API.moderateForceSkip"))return API.chatLog("plugCubed does not support one or more of the other scripts that are currently running because of potentional dangerous behaviour",!0),plugCubed.close()}}function P(a){if(a.from&&a.from.id){var b;if(b=API.getUser().permission>API.ROLE.RESIDENTDJ)b=API.getUser().id,b=n.isPlugCubedDeveloper(b)||n.isPlugCubedSponsor(b)||
n.isPlugCubedVIP(b);b&&(a.deletable=!0);"mention"===a.type&&(a.type+=" is-",API.hasPermission(a.from.id,API.ROLE.ADMIN)?a.type+="admin":API.hasPermission(a.from.id,API.ROLE.VOLUNTEER)?a.type+="ambassador":API.hasPermission(a.from.id,API.ROLE.BOUNCER)?a.type+="staff":API.hasPermission(a.from.id,API.ROLE.DJ)?a.type+="dj":a.type+="you",a.text=a.text.split("@"+API.getUser().username).join('<span class="name">@'+API.getUser().username+"</span>"));a.type+=" from";if(API.hasPermission(a.from.id,API.ROLE.RESIDENTDJ)||
a.from.id==API.getUser().id)a.type+="-";API.hasPermission(a.from.id,API.ROLE.ADMIN)?a.type+="admin":API.hasPermission(a.from.id,API.ROLE.AMBASSADOR)?a.type+="ambassador":API.hasPermission(a.from.id,API.ROLE.HOST)?a.type+="host":API.hasPermission(a.from.id,API.ROLE.COHOST)?a.type+="cohost":API.hasPermission(a.from.id,API.ROLE.MANAGER)?a.type+="manager":API.hasPermission(a.from.id,API.ROLE.BOUNCER)?a.type+="bouncer":API.hasPermission(a.from.id,API.ROLE.RESIDENTDJ)?a.type+="residentdj":a.from.id==API.getUser().id&&
(a.type+="you")}}function fa(){!0===w.get("mutedOnce")&&w.set("volume",w.get("lastVolume"))}function ga(){Q=setInterval(ca,1E3);R=setInterval(da,1E5);S=setInterval(ea,1E5);this.colors={userCommands:"66FFFF",modCommands:"FF0000",infoMessage1:"FFFF00",infoMessage2:"66FFFF"};this.defaultAwayMsg=c.i18n("autorespond.default");setTimeout(function(){u=[];var a=API.getHistory(),b;for(b in a){var c=a[b];u.push({id:c.media.id,author:c.media.author,title:c.media.title,wasSkipped:!1,dj:{id:c.user.id.toString(),
username:c.user.username}})}},1);this.customColorsStyle=b('<style type="text/css" />');b("head").append(this.customColorsStyle);n.chatLog(void 0,c.i18n("running",C)+'</span><br /><span class="chat-text" style="color:#66FFFF">'+c.i18n("commandsHelp"),this.colors.infoMessage1);window.addEventListener("pushState",this.proxy.onRoomJoin);b("body").prepend('<link rel="stylesheet" type="text/css" id="plugcubed-css" href="http://alpha.plugcubed.net/plugCubed.css?='+Date.now()+'" />');b("#plug-dj").after(T);
T.click(this.proxy.onMenuClick);b("#room-bar").css("left",108);w.off("change:volume",w.onVolumeChange);w.onVolumeChange=function(){"undefined"===typeof plugCubed?this.set("muted",0==this.get("volume")):(void 0===this.get("mutedOnce")&&this.set("mutedOnce",!1),0===this.get("volume")?!0===this.get("mutedOnce")?(this.set("mutedOnce",!1),this.set("muted",!0)):!0===this.get("muted")?this.set("muted",!1):this.set("mutedOnce",!0):(this.set("mutedOnce",!1),this.set("muted",!1)))};w.on("change:volume",w.onVolumeChange);
b("#volume").remove();this.volume=new aa;b("#now-playing-bar").append(this.volume.$el);this.volume.render();this.loadSettings();this.initAPIListeners();var a=API.getUsers(),g;for(g in a)0>r(a[g].id,"joinTime",-1)&&z(a[g].id,"joinTime",Date.now());b("#chat-header").append(b("<div>").addClass("chat-header-button p3-s-stream").data("key","stream").click(this.proxy.onMenuButtonClick).mouseover(function(){d.trigger("tooltip:show",c.i18n("tooltip.stream"),b(this),!0)}).mouseout(function(){d.trigger("tooltip:hide")})).append(b("<div>").addClass("chat-header-button p3-s-clear").data("key",
"clear").click(this.proxy.onMenuButtonClick).mouseover(function(){d.trigger("tooltip:show",c.i18n("tooltip.clear"),b(this),!0)}).mouseout(function(){d.trigger("tooltip:hide")}));this.changeGUIColor("stream",F.settings.streamDisabled);w.on("change:media",fa);w._events["change:media"].unshift(w._events["change:media"].pop());d.on("chat:receive",P);d._events["chat:receive"].unshift(d._events["chat:receive"].pop());M.prototype.RowClass=X;this.Socket();this.loaded=!0;N();b("#footer-links").append(b("<div />").addClass("footer").addClass("plugcubed-footer").css("top",
12).html(c.i18n("running",C)+c.i18n("footer.seperator")).append(b("<span />").addClass("plugcubed-status").text(c.i18n("footer.socket",c.i18n("footer.unknown")))))}function y(a,c,d){return b('<div class="item">').addClass("p3-s-"+c+(a?" selected":"")).append(b('<i class="icon icon-check-blue"></i>')).append(b("<span>").text(d)).data("key",c).click(plugCubed.proxy.onMenuButtonClick)}U.sio.$events.chat=k.listener.chat=function(a){"undefined"!==typeof plugCubed&&a.fromID&&z(a.fromID,"lastChat",Date.now());
l.receive(a);API.dispatch(API.CHAT,a)};var Q,R,S,C={major:3,minor:0,patch:3,prerelease:"alpha",build:131,minified:!0,toString:function(){return this.major+"."+this.minor+"."+this.patch+(void 0!==this.prerelease&&""!==this.prerelease?"-"+this.prerelease:"")+(this.minified?"_min":"")+" (Build "+this.build+")"}},u=[],I=!1,L=!1,q={},s={},x={},T=b('<div id="plug-cubed"><i class="icon icon-plug-cubed"></i></div>'),A,t;return f.extend({init:function(){"undefined"===typeof plugCubedUserData&&(plugCubedUserData=
{});this.proxy={onChatCommand:b.proxy(this.onChatCommand,this),onMenuButtonClick:b.proxy(this.onMenuButtonClick,this),onDjAdvance:b.proxy(this.onDjAdvance,this),onVoteUpdate:b.proxy(this.onVoteUpdate,this),onGrab:b.proxy(this.onGrab,this),onUserJoin:b.proxy(this.onUserJoin,this),onUserLeave:b.proxy(this.onUserLeave,this),onChat:b.proxy(this.onChat,this),onSkip:b.proxy(this.onSkip,this),onRoomJoin:b.proxy(this.onRoomJoin,this),onMenuClick:b.proxy(this.onMenuClick,this)};c.load(e.getItem("plugCubedLang"),
b.proxy(ga,this))},onRoomJoin:function(){"undefined"!==typeof plugCubed&&setTimeout(function(){if(API.enabled)b.getScript("http://alpha.plugcubed.net/plugCubed."+(C.minified?"min.":"")+"js?="+Date.now());else plugCubed.onRoomJoin()},500)},close:function(){void 0!==this.loaded&&!1!==this.loaded&&(clearInterval(Q),clearInterval(R),clearInterval(S),H({}),window.removeEventListener("pushState",plugCubed.proxy.onRoomJoin),API.off(API.CHAT_COMMAND,this.proxy.onChatCommand),API.off(API.DJ_ADVANCE,this.proxy.onDjAdvance),
API.off(API.VOTE_UPDATE,this.proxy.onVoteUpdate),API.off(API.CURATE_UPDATE,this.proxy.onGrab),API.off(API.USER_JOIN,this.proxy.onUserJoin),API.off(API.USER_LEAVE,this.proxy.onUserLeave),API.off(API.CHAT,this.proxy.onChat),API.off(API.VOTE_SKIP,this.proxy.onSkip),API.off(API.USER_SKIP,this.proxy.onSkip),API.off(API.MOD_SKIP,this.proxy.onSkip),d.off("chat:receive",P),b("#plugcubed-css,#font-awesome,#plugcubed-js-extra,#side-right,#side-left,#notify-dialog,.plugcubed-footer,#plug-cubed,#p3-settings,#p3-settings-custom-colors,.p3-s-stream,.p3-s-clear,#waitlist .user .afkTimer").remove(),
b("#room-bar").css("left",54),this.customColorsStyle&&this.customColorsStyle.remove(),t&&(t.onclose=function(){console.log("[plug³ Socket Server]","Closed")},t.close()),M.prototype.RowClass=W,requirejs.undef("plugCubed/Model"),requirejs.undef("plugCubed/dialogs/Notify"),requirejs.undef("plugCubed/dialogs/CustomChatColors"),requirejs.undef("plugCubed/dialogs/Commands"),requirejs.undef("plugCubed/Lang"),requirejs.undef("plugCubed/MenuView"),requirejs.undef("plugCubed/Utils"),requirejs.undef("plugCubed/Slider"),
requirejs.undef("plugCubed/Loader"),requirejs.undef("plugCubed/RoomUserListRow"),requirejs.undef("plugCubed/VolumeView"),v.destroy(),requirejs.undef("plugCubed/StyleManager"),this.loaded=!1,delete plugCubed)},Socket:function(){if(void 0===t||t.readyState!==SockJS.OPEN)t=new SockJS("http://socket.plugcubed.net/gateway"),t.tries=0,console.log("[plug³ Socket Server]",L?"Reconnecting":"Connecting"),t.onopen=function(){this.tries=0;console.log("[plug³ Socket Server]",L?"Reconnected":"Connected");var a=
API.getUser();this.send(JSON.stringify({type:"userdata",id:a.id,username:a.username,room:m.get("id"),version:C.toString()}));b(".plugcubed-status").text(c.i18n("footer.socket",c.i18n("footer.online")))},t.onmessage=function(a){var g=JSON.parse(a.data);a=g.type;g=g.data;if("update"===a)return this.onclose=function(){},this.close(),n.chatLog(void 0,c.i18n("newVersion"),plugCubed.colors.infoMessage1),setTimeout(function(){b.getScript("http://alpha.plugcubed.net/plugCubed."+(C.minified?"min.":"")+"js")},
5E3);if("chat"===a){if(!g.chatID||0<b(".chat-id-"+g.chatID).length)return;l.receive(g);return API.trigger(API.CHAT,g)}if("rave"===a&&(n.isPlugCubedDeveloper(g.id)||n.isPlugCubedSponsor(g.id)||API.hasPermission(g.id,API.ROLE.HOST))){clearTimeout(D.strobeTimeoutID);if(0===g.value)return D.onStrobeChange(null,0),!0;if(1===g.value)return D.onStrobeChange(null,2),n.chatLog(void 0,c.i18n("strobe",API.getUser(g.id).username)),!0;if(2===g.value)return D.onStrobeChange(null,1),n.chatLog(void 0,c.i18n("lightsOut",
API.getUser(g.id).username)),!0}if("broadcast"===a&&(n.isPlugCubedDeveloper(g.id)||n.isPlugCubedSponsor(g.id)))return n.chatLog("system","<strong>Broadcast from a "+c.i18n("info.specialTitles."+(n.isPlugCubedDeveloper(g.id)?"developer":"sponsor"))+'</strong><br /><span style="color:#FFFFFF;font-weight:400">'+g.message+"</span>")},t.onclose=function(){console.log("[plug³ Socket Server]","Closed");this.tries++;L=!0;var a;if(5>this.tries)a=5;else if(30>this.tries)a=30;else if(60>this.tries)a=60;else return;
setTimeout(function(){plugCubed.Socket()},1E3*a);b(".plugcubed-status").text(c.i18n("footer.socket",c.i18n("footer.offline")))}},colorInfo:{ranks:{you:{title:"ranks.you",color:"FFDD6F"},regular:{title:"ranks.regular",color:"B0B0B0"},residentdj:{title:"ranks.residentdj",color:"AC76FF"},bouncer:{title:"ranks.bouncer",color:"AC76FF"},manager:{title:"ranks.manager",color:"AC76FF"},cohost:{title:"ranks.cohost",color:"AC76FF"},host:{title:"ranks.host",color:"AC76FF"},ambassador:{title:"ranks.ambassador",
color:"89BE6C"},admin:{title:"ranks.admin",color:"42A5DC"}},notifications:{join:{title:"notify.join",color:"3366FF"},leave:{title:"notify.leave",color:"3366FF"},curate:{title:"notify.curate",color:"00FF00"},stats:{title:"notify.stats",color:"66FFFF"},updates:{title:"notify.updates",color:"FFFF00"},songLength:{title:"notify.songLength",color:"66FFFF"}}},settings:{recent:!1,awaymsg:"",autowoot:!1,autorespond:!1,notify:0,customColors:!1,avatarAnimations:!0,registeredSongs:[],alertson:[],autoMuted:!1,
afkTimers:!1,notifySongLength:10,useRoomSettings:{},colors:{you:"FFDD6F",regular:"B0B0B0",residentdj:"AC76FF",bouncer:"AC76FF",manager:"AC76FF",cohost:"AC76FF",host:"AC76FF",ambassador:"89BE6C",admin:"42A5DC",join:"3366FF",leave:"3366FF",curate:"00FF00",stats:"66FFFF",updates:"FFFF00",songLength:"66FFFF"}},loadSettings:function(){try{var a=JSON.parse(e.getItem("plugCubed")),b;for(b in this.settings)void 0!==a[b]&&(this.settings[b]=a[b]);this.settings.recent=!1;this.settings.autowoot&&O();this.updateCustomColors();
this.settings.afkTimers&&(n.isPlugCubedDeveloper()||API.hasPermission(void 0,API.ROLE.BOUNCER))&&v.set("waitListMove","#waitlist .list .user .name { top: 2px; }");127<this.settings.notify&&(this.settings.notify=0);0<this.settings.registeredSongs.length&&-1<this.settings.registeredSongs.indexOf(API.getMedia().id)?(setTimeout(function(){API.setVolume(0)},800),this.lastVolume=API.getVolume(),this.settings.autoMuted=!0,API.chatLog(c.i18n("automuted",API.getMedia().title))):this.settings.autoMuted=!1}catch(d){}},
saveSettings:function(){e.setItem("plugCubed",JSON.stringify(this.settings))},updateCustomColors:function(){var a=[],b=this.settings.useRoomSettings[window.location.pathname.split("/")[1]];((b=void 0===b||!0===b?!0:!1)&&q.regular||this.settings.colors.regular!==this.colorInfo.ranks.regular.color)&&a.push(".message.from > .from,",".emote.from > .from,",".mention.from > .from { color:#"+(this.settings.colors.regular!==this.colorInfo.ranks.regular.color?this.settings.colors.regular:q.regular)+"!important; }");
(b&&q.residentdj||this.settings.colors.residentdj!==this.colorInfo.ranks.residentdj.color)&&a.push(".message.from-residentdj > .from,",".emote.from-residentdj > .from,",".mention.from-residentdj > .from { color:#"+(this.settings.colors.residentdj!==this.colorInfo.ranks.residentdj.color?this.settings.colors.residentdj:q.residentdj)+"!important; }");(b&&q.bouncer||this.settings.colors.bouncer!==this.colorInfo.ranks.bouncer.color)&&a.push(".message.from-bouncer > .from,",".emote.from-bouncer > .from,",
".mention.from-bouncer > .from { color:#"+(this.settings.colors.bouncer!==this.colorInfo.ranks.bouncer.color?this.settings.colors.bouncer:q.bouncer)+"!important; }");(b&&q.manager||this.settings.colors.manager!==this.colorInfo.ranks.manager.color)&&a.push(".message.from-manager > .from,",".emote.from-manager > .from,",".mention.from-manager > .from { color:#"+(this.settings.colors.manager!==this.colorInfo.ranks.manager.color?this.settings.colors.manager:q.manager)+"!important; }");(b&&q.cohost||this.settings.colors.cohost!==
this.colorInfo.ranks.cohost.color)&&a.push(".message.from-cohost > .from,",".emote.from-cohost > .from,",".mention.from-cohost > .from { color:#"+(this.settings.colors.cohost!==this.colorInfo.ranks.cohost.color?this.settings.colors.cohost:q.cohost)+"!important; }");(b&&q.host||this.settings.colors.host!==this.colorInfo.ranks.host.color)&&a.push(".message.from-host > .from,",".emote.from-host > .from,",".mention.from-host > .from { color:#"+(this.settings.colors.host!==this.colorInfo.ranks.host.color?
this.settings.colors.host:q.host)+"!important; }");(b&&q.ambassador||this.settings.colors.ambassador!==this.colorInfo.ranks.ambassador.color)&&a.push(".message.from-ambassador > .from,",".emote.from-ambassador > .from,",".mention.from-ambassador > .from { color:#"+(this.settings.colors.ambassador!==this.colorInfo.ranks.ambassador.color?this.settings.colors.ambassador:q.ambassador)+"!important; }");(b&&q.admin||this.settings.colors.admin!==this.colorInfo.ranks.admin.color)&&a.push(".message.from-admin > .from,",
".emote.from-admin > .from,",".mention.from-admin > .from { color:#"+(this.settings.colors.admin!==this.colorInfo.ranks.admin.color?this.settings.colors.admin:q.admin)+"!important; }");(b&&q.you||this.settings.colors.you!==this.colorInfo.ranks.you.color)&&a.push(".message.from-you > .from,",".emote.from-you > .from,",".mention.from-you > .from { color:#"+(this.settings.colors.you!==this.colorInfo.ranks.you.color?this.settings.colors.you:q.you)+"!important; }");b&&(s.admin&&a.push(".message.from-admin > .icon,",
".emote.from-admin > .icon,",'.mention.from-admin > .icon { background-image: url("'+s.admin+'"); background-position: 0 0; }'),s.ambassador&&a.push(".message.from-ambassador > .icon,",".emote.from-ambassador > .icon,",'.mention.from-ambassador > .icon { background-image: url("'+s.ambassador+'"); background-position: 0 0; }'),s.bouncer&&a.push(".message.from-bouncer > .icon,",".emote.from-bouncer > .icon,",'.mention.from-bouncer > .icon { background-image: url("'+s.bouncer+'"); background-position: 0 0; }'),
s.cohost&&a.push(".message.from-cohost > .icon,",".emote.from-cohost > .icon,",'.mention.from-cohost > .icon { background-image: url("'+s.cohost+'"); background-position: 0 0; }'),s.residentdj&&a.push(".message.from-residentdj > .icon,",".emote.from-residentdj > .icon,",'.mention.from-residentdj > .icon { background-image: url("'+s.residentdj+'"); background-position: 0 0; }'),s.host&&a.push(".message.from-host > .icon,",".emote.from-host > .icon,",'.mention.from-host > .icon { background-image: url("'+
s.host+'"); background-position: 0 0; }'),s.manager&&a.push(".message.from-manager > .icon,",".emote.from-manager > .icon,",'.mention.from-manager > .icon { background-image: url("'+s.manager+'"); background-position: 0 0; }'));this.customColorsStyle.text(a.join("\n"))},initAPIListeners:function(){API.on(API.CHAT_COMMAND,this.proxy.onChatCommand);API.on(API.DJ_ADVANCE,this.proxy.onDjAdvance);API.on(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.on(API.CURATE_UPDATE,this.proxy.onGrab);API.on(API.USER_JOIN,
this.proxy.onUserJoin);API.on(API.USER_LEAVE,this.proxy.onUserLeave);API.on(API.CHAT,this.proxy.onChat);API.on(API.VOTE_SKIP,this.proxy.onSkip);API.on(API.USER_SKIP,this.proxy.onSkip);API.on(API.MOD_SKIP,this.proxy.onSkip)},changeGUIColor:function(a,c){b(".p3-s-"+a).removeClass("selected");c&&b(".p3-s-"+a).addClass("selected")},moderation:function(a,b){if(API.hasPermission(void 0,API.ROLE.BOUNCER)){var d;switch(b){case "removedj":d=API.moderateRemoveDJ;break;case "adddj":d=API.moderateAddDJ;break;
default:API.chatLog(c.i18n("error.unknownModeration"));return}var e=J(a);null===e?API.chatLog(c.i18n("error.userNotFound")):d(e.id," ")}},onMenuClick:function(){if(void 0!==A)return"0px"===A.css("left")?(A.animate({left:-271}),G.hide()):A.animate({left:0});A=b('<div id="p3-settings" style="left: -271px;">').append(b('<div class="header">').append(b('<div class="back">').append(b('<i class="icon icon-back"></i>')).click(function(){void 0!==A&&A.animate({left:-271});G.hide()})).append(b('<div class="title">').append(b('<i class="icon icon-settings"></i>')).append(b("<span>plug&#179;</span>")).append(b("<span>").addClass("version").text(C)))).append(b('<div class="container">').append(b('<div class="section">Features</div>')).append("undefined"===
typeof x.allowAutowoot||!1!==x.allowAutowoot?y(this.settings.autowoot,"woot",c.i18n("menu.autowoot")):"").append("undefined"===typeof x.allowAutorespond||!1!==x.allowAutorespond?y(this.settings.autorespond,"autorespond",c.i18n("menu.autorespond")):"").append("undefined"===typeof x.allowAutorespond||!1!==x.allowAutorespond?b('<div class="item">').addClass("p3-s-autorespond-input").append(b("<input>").val(""===plugCubed.settings.awaymsg?this.defaultAwayMsg:plugCubed.settings.awaymsg).keyup(function(){b(this).val(b(this).val().split("@").join(""));
plugCubed.settings.awaymsg=b(this).val().trim()})).mouseover(function(){d.trigger("tooltip:show",c.i18n("tooltip.afk"),b(this),!1)}).mouseout(function(){d.trigger("tooltip:hide")}):"").append(n.isPlugCubedDeveloper()||API.hasPermission(void 0,API.ROLE.BOUNCER)?y(this.settings.afkTimers,"afktimers",c.i18n("menu.afktimers")):"").append(I?y(void 0!==this.settings.useRoomSettings[window.location.pathname.split("/")[1]]?this.settings.useRoomSettings[window.location.pathname.split("/")[1]]:!0,"roomsettings",
c.i18n("menu.roomsettings")):"").append(y(!1,"colors",c.i18n("menu.customchatcolors")+"...")).append(b('<div class="spacer">').append(b('<div class="divider">'))).append(b('<div class="section">'+c.i18n("notify.header")+"</div>")).append(y(1===(this.settings.notify&1),"notify-join",c.i18n("notify.join")).data("bit",1)).append(y(2===(this.settings.notify&2),"notify-leave",c.i18n("notify.leave")).data("bit",2)).append(y(4===(this.settings.notify&4),"notify-curate",c.i18n("notify.curate")).data("bit",
4)).append(y(8===(this.settings.notify&8),"notify-stats",c.i18n("notify.stats")).data("bit",8)).append(y(16===(this.settings.notify&16),"notify-updates",c.i18n("notify.updates")).data("bit",16)));if(API.hasPermission(void 0,API.ROLE.BOUNCER)||n.isPlugCubedDeveloper()){var a=new Z(5,30,plugCubed.settings.notifySongLength,function(a){plugCubed.settings.notifySongLength=a;b(".p3-s-notify-songlength").find("span").text(c.i18n("notify.songLength",a))});A.find(".container").append(y(32===(this.settings.notify&
32),"notify-history",c.i18n("notify.history")).data("bit",32).data("perm",API.ROLE.BOUNCER)).append(y(64===(this.settings.notify&64),"notify-songlength",c.i18n("notify.songLength",plugCubed.settings.notifySongLength)).data("bit",64).data("perm",API.ROLE.BOUNCER)).append(a.$slider.css("left",40))}A.animate({left:0});b("body").append(A);if(void 0!==a)a.onChange()},onMenuButtonClick:function(a){a=b(a.currentTarget).data("key");switch(a){case "woot":this.settings.autowoot=!this.settings.autowoot;this.changeGUIColor("woot",
this.settings.autowoot);this.settings.autowoot&&b("#woot").click();break;case "colors":G.render();break;case "autorespond":this.settings.autorespond=!this.settings.autorespond;this.changeGUIColor("autorespond",this.settings.autorespond);this.settings.autorespond?(""===this.settings.awaymsg.trim()&&(this.settings.awaymsg=this.defaultAwayMsg),b("#chat-input-field").attr("disabled","disabled").attr("placeholder",c.i18n("autorespond.disable")),0>=API.getUser().status&&API.setStatus(API.STATUS.AFK)):(b("#chat-input-field").removeAttr("disabled").attr("placeholder",
V.chat.placeholder),API.setStatus(API.STATUS.AVAILABLE));break;case "notify-join":case "notify-leave":case "notify-curate":case "notify-stats":case "notify-updates":case "notify-history":case "notify-songlength":if(!b(".p3-s-"+a).data("perm")||API.hasPermission(void 0,b(".p3-s-"+a).data("perm"))||n.isPlugCubedDeveloper()){var g=b(".p3-s-"+a).data("bit");this.settings.notify+=(this.settings.notify&g)===g?-g:g;this.changeGUIColor(a,(this.settings.notify&g)===g);d.trigger("notify","icon-chat-system",
[c.i18n(a.split("-").join(".")),c.i18n("notify.header"),(this.settings.notify&g)===g?"enabled":"disabled"].join(" "))}break;case "stream":w.set("streamDisabled",!F.settings.streamDisabled);this.changeGUIColor("stream",F.settings.streamDisabled);return;case "clear":l.clear();return;case "roomsettings":a=this.settings.useRoomSettings[window.location.pathname.split("/")[1]];a=void 0===a||!0===a?!1:!0;this.settings.useRoomSettings[window.location.pathname.split("/")[1]]=a;(a?N:H)({});this.changeGUIColor("roomsettings",
a);break;case "afktimers":this.settings.afkTimers=!this.settings.afkTimers;this.changeGUIColor("afktimers",this.settings.afkTimers);this.settings.afkTimers?v.set("waitListMove","#waitlist .list .user .name { top: 2px; }"):(v.unset("waitListMove"),b("#waitlist .user .afkTimer").remove());break;default:return API.chatLog(c.i18n("error.unknownMenuKey",a))}this.saveSettings()},onColorDefault:function(){for(var a in this.settings.colors){var c=b('input[name="'+a+'"]');c.val(c.data("ph"));c.parents(".dialog-input-container").find(".dialog-input-label").css("color",
c.val().toRGB())}},onDjAdvance:function(a){8===(this.settings.notify&8)&&n.chatLog(void 0,c.i18n("notify.message.stats",a.lastPlay.score.positive,a.lastPlay.score.negative,a.lastPlay.score.curates),this.settings.colors.stats);16===(this.settings.notify&16)&&n.chatLog(void 0,c.i18n("notify.message.updates",a.media.title,a.media.author,h.cleanTypedString(a.dj.username)),this.settings.colors.updates);64===(this.settings.notify&64)&&a.media.duration>1E3*this.settings.notifySongLength&&(E(),setTimeout(function(){E()},
50),API.chatLog(c.i18n("notify.message.songLength",this.settings.notifySongLength),!0));setTimeout(b.proxy(this.onDjAdvanceLate,this),1E3*Math.randomRange(1,10));this.onHistoryCheck(a.media.id);50<u.unshift({id:a.media.id,author:a.media.author,title:a.media.title,wasSkipped:!1,user:{id:a.dj.id,username:a.dj.username}})&&u.splice(50,u.length-50);this.settings.autoMuted&&0>this.settings.registeredSongs.indexOf(a.media.id)&&(setTimeout(function(){API.setVolume(plugCubed.lastVolume)},800),this.settings.autoMuted=
!1);!this.settings.autoMuted&&-1<this.settings.registeredSongs.indexOf(a.media.id)&&(setTimeout(function(){API.setVolume(0)},800),this.settings.autoMuted=!0,this.lastVolume=API.getVolume(),API.chatLog(c.i18n("automuted",a.media.title)));a=API.getUsers();for(var d in a)z(a[d].id,"curVote",0)},onVoteUpdate:function(a){if(a&&a.user){var b=r(a.user.id,"curVote",0);1===b?z(a.user.id,"wootcount",r(a.user.id,"wootcount",0)-1):-1===b&&z(a.user.id,"mehcount",r(a.user.id,"mehcount",0)-1);1===a.vote?z(a.user.id,
"wootcount",r(a.user.id,"wootcount",0)+1):-1===a.vote&&z(a.user.id,"mehcount",r(a.user.id,"mehcount",0)+1);z(a.user.id,"curVote",a.vote)}},onGrab:function(a){var b=API.getMedia();4===(this.settings.notify&4)&&n.chatLog(void 0,c.i18n("notify.message.curate",h.cleanTypedString(a.user.username),b.author,b.title),this.settings.colors.curate)},onDjAdvanceLate:function(){this.settings.autowoot&&0>this.settings.registeredSongs.indexOf(API.getHistory()[0].media.id)&&O()},onUserJoin:function(a){if(1===(this.settings.notify&
1)){var b=m.getUserByID(a.id).get("relationship");n.chatLog(void 0,c.i18n("notify.message.join."+(0===b||void 0===b?"normal":1<b?"friend":"fan"),h.cleanTypedString(a.username)),this.settings.colors.join)}0===r(a.id,"joinTime",0)&&z(a.id,"joinTime",Date.now())},onUserLeave:function(a){2===(this.settings.notify&2)&&n.chatLog(void 0,c.i18n("notify.message.leave."+(0===a.relationship?"normal":1<a.relationship?"friend":"fan"),h.cleanTypedString(a.username)),this.settings.colors.leave);var b=r(a.id,"disconnects",
{count:0});b.count++;b.position=API.getDJ().id===a.id?-1:0>API.getWaitListPosition(a.id)?-2:API.getWaitListPosition(a.id);b.time=Date.now();z(a.id,"disconnects",b)},chatDisable:function(a){var b="mention"==a.type&&API.hasPermission(a.fromID,API.ROLE.BOUNCER),d=0>a.message.indexOf("@")&&(API.hasPermission(a.fromID,API.ROLE.HOST)||n.isPlugCubedDeveloper(a.fromID));if(b||d)-1<a.message.indexOf("!afkdisable")&&"undefined"===typeof x.allowAutorespond&&!1!==x.allowAutorespond&&(this.settings.autorespond?
(this.settings.autorespond=!1,this.changeGUIColor("autorespond",this.settings.autorespond),this.saveSettings(),API.sendChat(c.i18n("autorespond.commandDisable","@"+a.from))):API.sendChat(c.i18n("autorespond.commandNotEnabled","@"+a.from))),a.message.indexOf("!afkdisable")},onChat:function(a){this.chatDisable(a);if("mention"==a.type)this.settings.autorespond&&!this.settings.recent&&"undefined"===typeof x.allowAutorespond&&!1!==x.allowAutorespond&&(this.settings.recent=!0,b("#chat-input-field").attr("placeholder",
c.i18n("autorespond.nextIn",this.getTimestamp(Date.now()+18E4))),setTimeout(function(){b("#chat-input-field").attr("placeholder",c.i18n("autorespond.next"));plugCubed.settings.recent=!1;plugCubed.saveSettings()},18E4),API.sendChat("@"+a.from+" "+this.settings.awaymsg.split("@").join("")));else for(var d in this.settings.alertson)-1<a.message.indexOf(this.settings.alertson[d])&&document.getElementById("chat-sound").playChatSound()},onSkip:function(){u[1].wasSkipped=!0},onHistoryCheck:function(a){if((API.hasPermission(void 0,
API.ROLE.BOUNCER)||n.isPlugCubedDeveloper())&&32===(plugCubed.settings.notify&32)){var b=-1,d;for(d in u){var e=u[d];if(e.id==a&&~~d+1<u.length&&(b=~~d+2,!e.wasSkipped))return E(),setTimeout(function(){E()},50),API.chatLog(c.i18n("notify.message.history",b,u.length),!0)}if(0<b)return API.chatLog(c.i18n("notify.message.historySkipped",b,u.length),!0)}},getTimestamp:function(a,b){b||(b="hh:mm");var c=a?new Date(a):new Date,d=c.getHours(),e=c.getMinutes(),c=c.getSeconds(),d=(10>d?"0":"")+d,e=(10>e?"0":
"")+e,c=(10>c?"0":"")+c;return b.split("hh").join(d).split("mm").join(e).split("ss").join(c)},onChatCommand:function(a){if(0===a.indexOf("/commands"))return Y.print(),!0;if("/avail"==a||"/available"==a)return API.setStatus(0);if("/brb"==a||"/away"==a)return API.setStatus(1);if("/work"==a||"/working"==a)return API.setStatus(2);if("/game"==a||"/gaming"==a)return API.setStatus(3);if("/join"==a)return API.djJoin();if("/leave"==a)return API.djLeave();if("/whoami"==a)return K(API.getUser().id);if("/refresh"==
a)return b("#refresh-button").click();if("/version"==a)return API.chatLog(c.i18n("running",C));if("/mute"==a){if(0===API.getVolume())return;this.lastVolume=API.getVolume();return API.setVolume(0)}if("/link"==a)return API.sendChat("plugCubed : http://plugcubed.net");if("/unmute"==a)return 0<API.getVolume()?API.setVolume(this.lastVolume):!0;if("/nextsong"==a){a=API.getNextMedia();var m=-1;if(void 0===a)return API.chatLog(c.i18n("noNextSong"));a=a.media;for(var f in u){var k=u[f];if(k.id==a.id&&(m=~~f+
1,!k.wasSkipped))return API.chatLog(c.i18n("nextsong",a.title,a.author)),API.chatLog(c.i18n("isHistory",m,u.length),!0)}return API.chatLog(c.i18n("nextsong",a.title,a.author))}if("/automute"==a){k=API.getMedia();if(void 0===k)return;0>this.settings.registeredSongs.indexOf(k.id)?(this.settings.registeredSongs.push(k.id),this.settings.autoMuted=!0,this.lastVolume=API.getVolume(),API.setVolume(0),API.chatLog(c.i18n("automute.registered",k.title))):(this.settings.registeredSongs.splice(this.settings.registeredSongs.indexOf(API.getMedia().id),
1),this.settings.autoMuted=!1,API.setVolume(this.lastVolume),API.chatLog(c.i18n("automute.unregistered",k.title)));return this.saveSettings()}if(0===a.indexOf("/getpos"))f=J(a.substr(8)),f=null===f?API.getUser():f,a=API.getWaitListPosition(f.id),API.getDJ().id===f.id?API.chatLog(c.i18n("info.userDjing",f.id===API.getUser().id?c.i18n("ranks.you"):h.cleanTypedString(f.username))):0===a?API.chatLog(c.i18n("info.userNextDJ",f.id===API.getUser().id?c.i18n("ranks.you"):h.cleanTypedString(f.username))):
0<a?API.chatLog(c.i18n("info.inWaitlist",a+1,API.getWaitList().length)):API.chatLog(c.i18n("info.notInList"));else if("/curate"==a)for(m in k=JSON.parse(e.getItem("playlist")),k){if(k[m].selected)return d.dispatch(new B(B.CURATE,k[m].id)),!0}else if(0===a.indexOf("/alertson ")&&"/alertson"!==a.trim())this.settings.alertson=a.substr(10).split(" "),this.saveSettings(),API.chatLog("Playing sound on the following words: "+this.settings.alertson.join(", "));else if("/alertson"===a.trim()||0===a.indexOf("/alertsoff"))this.settings.alertson=
[],this.saveSettings(),API.chatLog("No longer playing sound on specific words");else{if((API.hasPermission(void 0,API.ROLE.AMBASSADOR)||n.isPlugCubedDeveloper())&&0===a.indexOf("/whois "))return"/whois all"===a.toLowerCase()?ba():K(a.substr(7));if((API.hasPermission(void 0,API.ROLE.AMBASSADOR)||n.isPlugCubedDeveloper()&&API.hasPermission(void 0,API.ROLE.MANAGER))&&0===a.indexOf("/banall"))for(f in a=API.getUser(),m=API.getUsers(),m)m[f].id!==a.id&&API.moderateBanUser(m[f].id,0,API.BAN.PERMA);else{if(API.hasPermission(void 0,
API.ROLE.BOUNCER)){if(0===a.indexOf("/skip")){if(void 0===API.getDJ())return;5<a.length&&API.sendChat("@"+API.getDJ().username+" - Reason for skip: "+a.substr(5).trim());return API.moderateForceSkip()}if(0===a.indexOf("/whois "))return K(a.substr(7));if(0===a.indexOf("/add "))return this.moderation(a.substr(5),"adddj");if(0===a.indexOf("/remove "))return this.moderation(a.substr(8),"removedj")}if(API.hasPermission(void 0,API.ROLE.MANAGER)){if("/lock"===a)return API.moderateLockWaitList(!0);if("/unlock"===
a)return API.moderateLockWaitList(!1);"/lockskip"===a&&(k=API.getDJ().id,API.once(API.DJ_ADVANCE,function(){API.once(API.WAIT_LIST_UPDATE,function(){API.moderateMoveDJ(k,1)});API.moderateAddDJ(k)}),API.moderateForceSkip())}if(API.hasPermission(void 0,API.ROLE.HOST)||n.isPlugCubedDeveloper()){if(0===a.indexOf("/strobe")){if(t.readyState!==SockJS.OPEN)return API.chatLog(c.i18n("error.notConnected"),!0);f=a.split(" ");-1<a.indexOf("off")?t.send(JSON.stringify({type:"rave",value:0})):1<f.length&&f[1].isNumber()&&
50<=~~f[1]&&100>=~~f[1]?t.send(JSON.stringify({type:"rave",value:~~f[1]})):t.send(JSON.stringify({type:"rave",value:1}))}if(0===a.indexOf("/rave")){if(t.readyState!==SockJS.OPEN)return API.chatLog(c.i18n("error.notConnected"),!0);t.send(JSON.stringify({type:"rave",value:-1<a.indexOf("off")?0:2}))}}}}}})});define("plugCubed/dialogs/CustomChatColors",["jquery","e388d/de6ec/ed34d","lang/Lang","e388d/de6ec/aeb58","plugCubed/Lang"],function(b,p,f,d,l){function e(e,f,k){return b('<div class="item">').addClass("p3-s-cc-"+
e).append(b("<span>").text(f)).append(b("<span>").addClass("default").css("display",plugCubed.settings.colors[e]===k?"none":"block").mouseover(function(){d.trigger("tooltip:show",l.i18n("tooltip.reset"),b(this),!1)}).mouseout(function(){d.trigger("tooltip:hide")}).click(function(){b(this).parent().find("input").val(k);b(this).parent().find(".example").css("background-color",k.toRGB());b(this).css("display","none");plugCubed.settings.colors[e]=k;plugCubed.saveSettings();plugCubed.updateCustomColors()})).append(b("<span>").addClass("example").css("background-color",
plugCubed.settings.colors[e].toRGB())).append(b("<input>").val(plugCubed.settings.colors[e]).keyup(function(){b(this).val().isRGB()&&(b(this).parent().find(".example").css("background-color",b(this).val().toRGB()),plugCubed.settings.colors[e]=b(this).val(),plugCubed.saveSettings(),plugCubed.updateCustomColors());b(this).parent().find(".default").css("display",b(this).val()===k?"none":"block")}))}var h;return new (p.extend({render:function(){if(void 0!==h)return"-271px"===h.css("left")?h.animate({left:b("#p3-settings").width()+
1}):h.animate({left:-271});var d=b('<div class="container">').append(b('<div class="section">').text("User Ranks")),f;for(f in plugCubed.colorInfo.ranks)d.append(e(f,l.i18n(plugCubed.colorInfo.ranks[f].title),plugCubed.colorInfo.ranks[f].color));d.append(b('<div class="spacer">').append(b('<div class="divider">'))).append(b('<div class="section">').text(l.i18n("notify.header")));for(f in plugCubed.colorInfo.notifications)d.append(e(f,l.i18n(plugCubed.colorInfo.notifications[f].title),plugCubed.colorInfo.notifications[f].color));
h=b('<div id="p3-settings-custom-colors" style="left: -271px;">').append(b('<div class="header">').append(b('<div class="back">').append(b('<i class="icon icon-back"></i>')).click(function(){void 0!==h&&h.animate({left:-271})})).append(b('<div class="title">').append(b("<span>").text(l.i18n("menu.customchatcolors"))))).append(d).animate({left:b("#p3-settings").width()+1});b("body").append(h)},hide:function(){void 0!==h&&h.animate({left:-271})}}))});define("plugCubed/dialogs/Userinfo","jquery e388d/c2954/b05e7/a4fba lang/Lang e388d/de6ec/ed34d e388d/de6ec/aeb58 e388d/f4646/aa466 plugCubed/Lang".split(" "),
function(b,p,f,d,l,e,h){return d.extend({init:function(b){l.dispatch(new e(e.SHOW,new p.extend({id:"dialog-userinfo",className:"dialog",render:function(){return this.$el.append(this.getHeader(h.i18n("info.header"))).append(this.getBody().append(b)),this._super()},submit:function(){this.close()}})))}})});define("plugCubed/dialogs/Commands",["jquery","e388d/de6ec/ed34d","lang/Lang","plugCubed/Lang","plugCubed/Utils"],function(b,p,f,d,l){var e=[["/nick","commands.descriptions.nick"],["/avail","commands.descriptions.avail"],
["/afk","commands.descriptions.afk"],["/work","commands.descriptions.work"],["/gaming","commands.descriptions.gaming"],["/join","commands.descriptions.join"],["/leave","commands.descriptions.leave"],["/whoami","commands.descriptions.whoami"],["/mute","commands.descriptions.mute"],["/automute","commands.descriptions.automute"],["/unmute","commands.descriptions.unmute"],["/nextsong","commands.descriptions.nextsong"],["/refresh","commands.descriptions.refresh"],["/alertson (commands.variables.word)",
"commands.descriptions.alertson"],["/alertsoff","commands.descriptions.alertsoff"],["/curate","commands.descriptions.curate"],["/getpos","commands.descriptions.getpos"],["/version","commands.descriptions.version"],["/commands","commands.descriptions.commands"],["/link","commands.descriptions.link"]],h=[["/whois (commands.variables.username)","commands.descriptions.whois",API.ROLE.BOUNCER],["/skip","commands.descriptions.skip",API.ROLE.BOUNCER],["/ban (commands.variables.username)","commands.descriptions.ban",
API.ROLE.BOUNCER],["/lockskip","commands.descriptions.lockskip",API.ROLE.MANAGER],["/lock","commands.descriptions.lock",API.ROLE.MANAGER],["/unlock","commands.descriptions.unlock",API.ROLE.MANAGER],["/add (commands.variables.username)","commands.descriptions.add",API.ROLE.BOUNCER],["/remove (commands.variables.username)","commands.descriptions.remove",API.ROLE.BOUNCER],["/strobe (commands.variables.onoff)","commands.descriptions.strobe",API.ROLE.HOST],["/rave (commands.variables.onoff)","commands.descriptions.rave",
API.ROLE.HOST],["/whois all","commands.descriptions.whois",API.ROLE.AMBASSADOR],["/banall","commands.descriptions.banall",API.ROLE.AMBASSADOR]];return new (p.extend({print:function(){var b='<strong style="font-size:1.4em;">'+d.i18n("commands.header")+"</strong><br />",b=b+('<strong style="position:relative;left:-20px;">=== '+d.i18n("commands.userCommands")+" ===</strong><br />"),f;for(f in e){var k=e[f][0];1<k.split("(").length&&(k=k.split("(")[0]+"("+d.i18n(k.split("(")[1].split(")")[0])+")");b+=
'<div style="position:relative;left:-10px;">'+k+'<br /><em style="position:relative;left: 25px;">'+d.i18n(e[f][1])+"</em></div>"}if(API.hasPermission(void 0,API.ROLE.BOUNCER))for(f in b+='<br /><strong style="position:relative;left:-20px;">=== '+d.i18n("commands.modCommands")+" ===</strong><br />",h)API.hasPermission(void 0,h[f][2])&&(k=h[f][0],1<k.split("(").length&&(k=k.split("(")[0]+"("+d.i18n(k.split("(")[1].split(")")[0])+")"),b+='<div style="position:relative;left:-10px;">'+k+'<br /><em style="position:relative;left: 25px;">'+
d.i18n(h[f][1])+"</em></div>");l.chatLog(void 0,b)}}))});define("plugCubed/StyleManager",["jquery","e388d/de6ec/ed34d"],function(b,p){var f,d={},l=function(){var b="",h;for(h in d)b+=d[h];f.text(b)};return new (p.extend({init:function(){f=b('<style type="text/css">');b("head").append(f)},set:function(b,f){d[b]=f;l()},has:function(b){return void 0!==d[b]},unset:function(b){"string"===typeof b&&(b=[b]);var f=!1,m;for(m in b)this.has(b[m])&&(delete d[b[m]],f=!0);f&&l()},destroy:function(){d={};f.remove()}}))});
define("plugCubed/Utils",["e388d/c2954/faf6b/cc0b1/a32f2"],function(b){var p=function(b){var d="span div table tr td br br/ strong em".split(" ");return b.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,f){return-1<d.indexOf(f.toLowerCase())?b:""})};return{isPlugCubedDeveloper:function(b){b||(b=API.getUser().id);return"50aeb31696fba52c3ca0adb6"==b},isPlugCubedSponsor:function(b){b||(b=API.getUser().id);return-1<["5121578196fba506408bb9eb"].indexOf(b)},isPlugCubedVIP:function(b){b||(b=API.getUser().id);
return-1<["5112c273d6e4a94ec0554792","50b1961c96fba57db2230417","50aeb077877b9217e2fbff00","50aeb020d6e4a94f774740a9"].indexOf(b)},isPlugCubedDonator:function(b){b||(b=API.getUser().id);return-1<[].indexOf(b)},chatLog:function(f,d,l){if(d){"string"!==typeof d&&(d=d.html());d=p(d);var e=b._window?$(b._window.document).find("#chat-messages"):$("#chat-messages"),h=e.scrollTop()>e[0].scrollHeight-e.height()-20,m=$("<div>").addClass(f?f:"update");d=$("<span>").addClass("text").html(d);"system"===f?m.append('<i class="icon icon-chat-system"></i>'):
d.css("color",(l?l:"d1d1d1").toRGB());e.append(m.append(d));h&&e.scrollTop(e[0].scrollHeight)}}}});define("plugCubed/RoomUserListRow",["jquery","e388d/c2954/faf6b/c591d/e1d9e","plugCubed/Utils"],function(b,p,f){return p.extend({vote:function(){this.model.get("curated")||0!==this.model.get("vote")?(this.$icon||(this.$icon=b("<i/>").addClass("icon")),this.$el.append(this.$icon),this.model.get("curated")?this.$icon.removeClass().addClass("icon icon-curate"):1==this.model.get("vote")?this.$icon.removeClass().addClass("icon icon-woot"):
this.$icon.removeClass().addClass("icon icon-meh")):this.$icon&&(this.$icon.remove(),this.$icon=void 0)}})});define("plugCubed/Lang",["jquery","e388d/de6ec/ed34d"],function(b,p){var f={},d=!1;return new (p.extend({init:function(){var l=this;b.getJSON("http://alpha.plugcubed.net/langs/lang.en.json?_"+Date.now(),function(b){f=b;d=!0}).error(function(){setTimeout(function(){l.init()},500)})},load:function(l,e){if(!d){var h=this;return setTimeout(function(){h.load(l,e)},500)}l&&"en"!==l?b.getJSON("http://alpha.plugcubed.net/langs/lang."+
l+".json",function(d){f=b.extend(!0,f,d);e&&e()}).error(function(){e&&e()}):e&&e()},i18n:function(d){var e=f,h;if(void 0===e)return"{"+b.makeArray(arguments).join(", ")+"}";var m=d.split(".");for(h in m){if(void 0===e[m[h]])return"{"+b.makeArray(arguments).join(", ")+"}";e=e[m[h]]}if(1<arguments.length)for(h=1;h<arguments.length;h++)e=e.split("%"+h).join(arguments[h]);return e}}))});define("plugCubed/Slider",["jquery","e388d/de6ec/ed34d"],function(b,p){return p.extend({init:function(f,d,l,e){this.min=
f?f:0;this.max=d?d:100;this.value=l?l:this.min;this.cb=e;this.startBind=b.proxy(this.onStart,this);this.moveBind=b.proxy(this.onUpdate,this);this.stopBind=b.proxy(this.onStop,this);this.clickBind=b.proxy(this.onClick,this);this.$slider=b('<div class="p3slider"><div class="line"></div><div class="circle"></div><div class="hit"></div></div>');this.$line=this.$slider.find(".line");this.$hit=this.$slider.find(".hit");this.$circle=this.$slider.find(".circle");this.$hit.mousedown(this.startBind);this._max=
this.$hit.width()-this.$circle.width();this.onChange();return this},onStart:function(f){this._min=this.$hit.offset().left;this._max=this.$hit.width()-this.$circle.width();b(document).on("mouseup",this.stopBind).on("mousemove",this.moveBind);return this.onUpdate(f)},onUpdate:function(b){this.value=Math.max(this.min,Math.min(this.max,~~((b.pageX-this._min)/this._max*(this.max-this.min))+this.min));this.onChange();b.preventDefault();b.stopPropagation();return!1},onStop:function(f){b(document).off("mouseup",
this.stopBind).off("mousemove",this.moveBind);f.preventDefault();f.stopPropagation();return!1},onChange:function(){this.$circle.css("left",parseInt(this.$hit.css("left"))+this.$line.width()*((this.value-this.min)/(this.max-this.min))-this.$circle.width()/2);"function"===typeof this.cb&&this.cb(this.value)}})});define("plugCubed/Loader","jquery e388d/de6ec/ed34d plugCubed/Model e388d/c5c7d/a1b5f e388d/c2954/b05e7/a4fba plugCubed/Lang plugCubed/Utils".split(" "),function(b,p,f,d,l,e,h){e=d.getItem("plugCubedLang");
return null!==e&&"@@@"!==e?p.extend({init:function(){plugCubed=new f}}):l.extend({id:"plugCubedLang-panel",className:"dialog",render:function(){var d=this;console.log(d);this.languages=[];b.getJSON("http://alpha.plugcubed.net/lang.json",function(e){d.languages=e;this.$el.append(this.getHeader("plug&#179; language")).append(this.getBody().append(this.getMessage(this.draw())));_.defer(_.bind(this.adjustTop,this));b(".lang-button").click(b.proxy(this.onLangClick,this));return this._super()}).done(function(){0===
d.languages.length&&h.chatLog(void 0,'<span style="color:#FF0000">Error loading plugCubed</span>')})},draw:function(){var d=this.languages.length,e=b("<div/>");if(5<d)for(var f=0;f<d/5;f++)e.append(this.drawRow(this.languages.slice(5*f,5*f+5)).css("top",75*f));else e.append(this.drawRow(this.languages).css("top",75*f));return e},drawRow:function(d){for(var e=b("<div/>").addClass("lang-row"),f=d.length,h=5==f?0:4==f?75:3==f?150:2==f?225:300,l=0;l<f;++l){var p=b("<div/>").addClass("lang-button").css("display",
"inline-block").css("left",h).data("language",d[l].file).css("cursor","pointer").append(b("<img/>").attr("src","http://alpha.plugcubed.net/flags/flag."+d[l].file+".png").attr("alt",d[l].name).height(75).width(150));e.append(p);h+=150}return e},onLangClick:function(e){e=b(e.currentTarget);d.setItem("plugCubedLang",e.data("language"),!0);plugCubed=new f;this.close()}})});define("plugCubed/VolumeView","jquery underscore e388d/c2954/faf6b/af2a0/ea2f5 e388d/f46a4/f3ed8 hbs!template/room/playback/Volume e388d/de6ec/aeb58 plugCubed/Lang".split(" "),
function(b,p,f,d,l,e,h){return f.extend({render:function(){this.$el.html(l());this.$icon=this.$(".button i");this.$hit=this.$(".hit").mousedown(p.bind(this.onStart,this));this.$slider=this.$(".slider");this.$circle=this.$(".circle");this.$span=this.$("span");this.max=this.$hit.width()-this.$circle.width();this.$circle.css("left",parseInt(this.$hit.css("left"))+this.max*(d.get("volume")/100)-this.$circle.width()/2);this.$(".button").on("click",this.clickBind).mouseover(function(){"undefined"!==typeof plugCubed&&
(d.get("mutedOnce")&&e.trigger("tooltip:show",h.i18n("tooltip.mutedOnce"),b(this),!0),d.get("muted")&&e.trigger("tooltip:show",h.i18n("tooltip.muted"),b(this),!0))}).mouseout(function(){"undefined"!==typeof plugCubed&&e.trigger("tooltip:hide")});d.on("change:volume change:muted",this.onChange,this);this.onChange();return this},remove:function(){this._super();this.$(".button").off("click",this.clickBind);d.off("change:volume change:muted",this.onChange,this);this.$el.empty();this.$el.off();this.off();
this.$icon=this.$hit=this.$slider=this.$circle=this.el=this.$el=void 0},onClick:function(){"undefined"!==typeof plugCubed&&(e.trigger("tooltip:hide"),d.get("mutedOnce")?e.trigger("tooltip:show",h.i18n("tooltip.muted"),this.$(".button"),!0):d.get("muted")||e.trigger("tooltip:show",h.i18n("tooltip.mutedOnce"),this.$(".button"),!0));if(d.get("mutedOnce"))d.onVolumeChange();else d.get("muted")?d.set("volume",d.get("lastVolume")):d.set({lastVolume:d.get("volume"),volume:0})},onChange:function(){var b=
d.get("volume");this.$span.text(b+"%");this.$circle.css("left",parseInt(this.$hit.css("left"))+b/100*this.max-this.$circle.width()/2);60<b?this.$icon.hasClass("icon-volume-on")||this.$icon.removeClass().addClass("icon icon-volume-on"):0<b?this.$icon.hasClass("icon-volume-half")||this.$icon.removeClass().addClass("icon icon-volume-half"):d.get("muted")&&!this.$icon.hasClass("icon-volume-off")?this.$icon.removeClass().addClass("icon icon-volume-off"):d.get("mutedOnce")&&!this.$icon.hasClass("icon-volume-off-once")&&
this.$icon.removeClass().addClass("icon icon-volume-off-once")}})});require(["plugCubed/Model","plugCubed/Utils"],function(b,p){plugCubed=new b})})();
